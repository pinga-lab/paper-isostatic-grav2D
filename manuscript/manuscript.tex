%\documentclass[paper,twocolumn,twoside]{geophysics}
%\documentclass[manuscript,revised]{geophysics}
\documentclass[manuscript]{geophysics}

% An example of defining macros
\newcommand{\rs}[1]{\mathstrut\mbox{\scriptsize\rm #1}}
\newcommand{\rr}[1]{\mbox{\rm #1}}

% Extra packages
\usepackage{amsmath}
\usepackage{bm}
\usepackage[pdftex,colorlinks=true]{hyperref}
\hypersetup{
	allcolors=black,
}
\usepackage{lipsum}
\usepackage[table]{xcolor}

\renewcommand{\figdir}{figures} % figure directory

\begin{document}

\title{Isostatic constraint for 2D gravity inversion on passive rifted margins}

\renewcommand{\thefootnote}{\fnsymbol{footnote}} 

\ms{GEO-XXXX} % manuscript number

%\address{
%\footnotemark[1]Observat\'{o}rio Nacional, \\
%Department of Geophysics, \\
%Rio de Janeiro, Brazil}
%\author{B. Marcela S. Bastos\footnotemark[1] and Vanderlei C. Oliveira Jr\footnotemark[1]}

%\footer{vanderlei@on.br}
%\lefthead{Bastos and Oliveira Jr.}
\righthead{Isostatic constraint for gravity inversion on passive margins}

\maketitle

\begin{abstract}

We propose a new gravity inversion method for jointly estimating the basement and 
Moho reliefs along a profile crossing a passive rifted margin.
We approximate the subsurface by an interpretation model composed of 
adjacent columns, each one formed by vertically stacked prisms having constant 
and known density contrasts.
Our method consists in solving a nonlinear inverse problem to estimate the 
thickness of specific prisms defining the basement and Moho geometries, 
as well as a constant thickness defining the maximum depth of our interpretation 
model.
This maximum depth represents a planar reference Moho.
To obtain stable solutions, we impose smoothness on the basement and Moho relief,
force them to be close to previously estimated depths along the profile and also 
impose local isostatic equilibrium.
Our method imposes isostatic equilibrium by constraining the lithostatic stress 
exerted by the interpretation model at a given constant depth, 
below which there are no lateral density variations.
This isostatic constraint introduces the information that the lithostatic stress 
is mostly smooth, except at some isolated regions, where it can present abrupt 
variations. At these regions, our method enables the interpretation model to deviate
from the isostatic equilibrium.
Tests with synthetic data show the good performance of our method in
determining the basement and Moho geometries at regions with  
pronounced crustal thinning, which is typical of passive volcanic margins.
Results obtained by our method at the Pelotas basin, considered a classical example
of passive volcanic margin at the southern of Brazil, agree with a previous
interpretation obtained independently by using ultra-deep seismic data.
The applications to synthetic and real data show that our method is a
promising tool for interpreting gravity data on passive rifted margins.


\end{abstract}

\section{Introduction}

Several methods have been proposed for using gravity data
to estimate the boundaries of juxtaposed sedimentary layers, 
the relief of basement and the Mohorovicic discontinuity (or simply Moho).
These geophysical discontinuities represent, in such methods, 
surfaces having density contrasts in subsurface.
All these methods suffer from the inherent ambiguity \citep{skeels1947, roy1962} in
determining the true physical property distribution that produces a discrete set of
observed gravity data. 
It is well known that, by using different density contrasts, 
it is possible to find different surfaces producing the same gravity data. 
To partially overcome this problem and obtain meaningful solutions, the interpreter
must commonly use a priori information obtained from seismic data and/or boreholes in
order to constrain the range of possible models.
Here, we consider methods that approximate the subsurface by a set of layers 
that have constant or depth-dependent density contrast and are separated 
by surfaces representing the geophysical discontinuities.
In such methods, the geometry of the discontinuities are directly 
determined by estimating the geometrical parameters defining the surfaces.

Different criteria can be used to classify the methods that directly estimate
the geometry of geophysical discontinuities.
Those applied over a sedimentary basin, for example, can be considered local scale methods,
whereas those applied over a continent or country can be considered regional scale methods
and those applied over the whole globe can be considered global scale methods.
They can also be classified according to the number of geophysical surfaces
to be estimated.
By using these criteria, it is possible to define a first group of methods
estimating the geometry of a single surface.
In this group, there are local scale methods in the space domain
% scale: local | data: gravity | domain: space
\citep[e.g.,][]{bott1960, tanner1967, cordell-henderson1968, dyrelius-vogel1972, 
pedersen1977, richardson-macinnes1989, barbosa-etal1997, condi-etal1999, 
barbosa-etal1999, barbosa-etal1999b, silva-etal2006,  
chakravarthi-sundararajan2007, martins-etal2010, silva-etal2010, lima-etal2011, 
martins-etal2011, barnes-barraud2012, silva-etal2014, silva-santos2017},
and the Fourier domain
% scale: local | data: gravity | domain: Fourier
\citep[e.g.,][]{oldenburg1974, granser1987, reamer-ferguson1989, guspi1993}.
Most of these methods were applied to estimate the relief of basement under
a sedimentary basin.
There are also regional scale methods for estimating a single surface 
representing the Moho in the space domain 
% scale: regional | data: gravity | domain: space
\citep[e.g.,][]{shin-etal2009, bagherbandi-eshagh2012, barzaghi-biagi2014, 
sampietro2015, uieda-barbosa2017} and in the Fourier domain 
% scale: regional | data: gravity | domain: Fourier
\citep[e.g.,][]{braitenberg-etal1997, braitenberg-zadro1999, vandermeijde-etal2013}.
Additionally, there are some global scale methods, in space domain, for estimating the Moho
% scale: global | data: gravity | domain: space
\citep[e.g.,][]{sunkel1985, sjoberg2009}, 
and also the crustal thickness of the Moon \citep{zhang-etal2019}.

The second group of methods is formed by those estimating multiple surfaces
separating layers with constant or depth-dependent density distribution 
\citep[e.g.,][]{condi-etal1999, camacho-etal2011, salem-etal2014, 
ferderer-etal2017, garcia-abdeslem2017, salem2017}.
All these methods have been applied at local scale, to characterize a single 
sedimentary basin.
It is known that these methods suffer from a greater ambiguity if compared with 
those estimating the geometry of a single surface.
As a consequence, they require more a priori information to
decrease the number of possible solutions. 
To reduce this inherent ambiguity, these methods followed different approaches
for combining gravity data with seismic and isostasy 
to determine the geometries of basement and Moho surfaces, which are important 
constraints on the amount of extension and heat flow at a margin during rifting
\citep{watts-fairhead1999}.

\citet{condi-etal1999} proposed a nonlinear gravity inversion for estimating the
offshore deep structures of a rifted margin.
They approximate the margin by using multiple irregular polygons, each having a 
uniform density and fixed horizontal position of their vertices.
The polygons represent four homogeneous layers: water, sediments, crust and mantle.
The parameters to be estimated are the constant densities of each polygon and 
the vertical positions of the vertices separating adjacent layers.
The parameters are estimated by using a globally convergent Newton method
together with an algorithm for solving sparse linear systems.
Their method uses local isostasy and uniform extension for directly constraining the 
geometries of the shallow and deeper parts of their model, without necessarily
forcing it to be in a perfect isostatic equilibrium.

\citet{salem-etal2014} presented a nonlinear gravity inversion for estimating the 
surfaces representing basement and Moho on an onshore rifted basin. 
They approximate the rifted basin by using three homogeneous layers: sediments, crust and mantle.
The layers are also described in terms of irregular polygons having constant density
contrasts.
The horizontal positions of the polygon vertices are fixed and the vertical positions
of the vertices associated with basement and Moho are the parameters to be estimated by 
inversion.
The position of the vertices associated with basement are estimated 
by using an iterative approach similar to that
presented by \citet{bott1960} and \citet{cordell-henderson1968}. 
The difference is that, at each iteration, the Airy-Heiskanen model
\citep{heiskanen-moritz1967} for local isostatic equilibrium is used 
to subsequently update the Moho geometry, forcing the model to be in
perfect isostatic equilibrium according to the Airy-Heiskanen model.
Notice that their method does not estimate the geometries of basement and Moho 
simultaneously.
As properly pointed out by \citet{silva-etal2014}, \citeauthor{bott1960}'s
method does not define optimal step sizes at the iterative corrections,
does not impose constraints for obtaining stable solutions, nor use
an objective stopping criterion. 
Consequently, the method presented by \citet{salem-etal2014} is also susceptible 
to these limitations.

\citet{garcia-abdeslem2017} presented a method for estimating the 
geometries of basement and Moho on the Montage Basin, located between Mexico and USA.
He uses an approach based on flexural isostasy to estimate the Moho and compute 
a regional gravity field, which is subsequently subtracted from the observed gravity 
data to obtain a residual gravity field. 
His method consists in solving a nonlinear inverse problem for estimating the
basement geometry explaining the residual gravity field.

\citet{salem2017} presents a general framework for estimating the surfaces associated with
basement and Moho on a rifted continental margin.
He also approximates the margin by using a set of irregular polygons
representing water, sediments, crust and mantle.
The density contrasts of these layers are considered to be known functions
of the horizontal position along the profile.
His method is based on an empirical logistic function that acts as a gain control of the 
Moho uplift.
Similarly to \citet{salem-etal2014} and \citet{garcia-abdeslem2017}, the method presented
by \citet{salem2017} does not estimate the surfaces of basement and Moho simultaneously.
The Moho surface is estimated in a first step and then used to estimate the basement surface.

\citet{ferderer-etal2017} proposed a ``general local isostasy" approach, which consists
in combining the Airy-Heiskanen and Pratt-Hayford models \citep{heiskanen-moritz1967} 
so that the crust density and geometry 
may vary laterally in order to maintain the local isostatic equilibrium on a profile crossing
a rifted margin. Their approach also uses local isostasy to directly link the geometries
of shallow and deeper structures with the purpose of reducing the range of possible solutions.
They approximate the margin by using a set irregular polygons and propose a method 
for estimating their shapes and density contrasts by using a 
grid-search technique \citep{sen-stoffa2013}.
Such techniques involve the systematic search for model parameters producing the best data fit
and may be far from being practical in geophysical applications for the cases in which
the model space is very large and the forward problem is slow.

We present a new local scale method for simultaneously estimating the geometries
of basement and Moho surfaces, as well as a constant depth representing a reference Moho
along a profile crossing a rifted margin.
We approximate the margin by an interpretation model formed by four adjacent layers.
Layers 1 represents water with constant density contrast.
Layer 2 can have an arbitrary number of sub-layers with constant density
to represent, for example, sediments, salt and volcanic rocks.
These sub-layers are predefined by the interpreter according to
the complexity of the study area and the available priori information.
Layer 3 represents the crust with a predefined density distribution
variating along the profile.
Finally, Layer 4 represents the mantle with constant density contrast.
Our method is formulated, in the space domain, as a nonlinear gravity inversion
based on the Levenberg-Marquardt method \citep{silva-etal2001, aster-etal2005}, 
by following a strategy similar to \citet{barbosa-etal1999}.
The parameters to be estimated by inversion define a constant depth representing the
reference Moho, as well as the geometries of 
basement, which separates Layers 2 and 3, and Moho, which separates Layers 3 and 4.
The remaining surfaces are fixed.
At each iteration, our method estimates corrections for the geometries of
basement and Moho simultaneously. 
In order to produce stable solutions,
we use different constraints imposing smoothness on basement and Moho surfaces, 
as well as force them to be close to some depths along the profile. 

Similarly to \citet{ferderer-etal2017}, we combine the Airy-Heiskanen and Pratt-Hayford
models to impose local isostatic equilibrium.
Differently from previous methods, we do not use local isostasy to directly link
the geometries of basement and Moho.
Rather, we impose smoothness on the lithostatic stress exerted by the interpretation 
model on a constant compensation depth, below which there is no lateral density variations.
This information is directionally consistent with the basic principle of 
local isostatic equilibrium according to the Airy-Heiskanen and Pratt-Hayford models.
Our constraint, which we conveniently call the \textit{isostatic constraint},
introduces the information that the lithostatic stress must be mostly smooth along the 
entire profile, except at some isolated regions, where it can present abrupt variations.
At these regions, our method enables the estimated model to deviate from the 
isostatic equilibrium.
As a consequence, our method does not estimate a model in perfect isostatic equilibrium, 
but a model as close as possible to the local isostatic equilibrium. 
Different models can be obtained by setting a scalar parameter that controls 
how much the estimated models can deviate from the isostatic equilibrium.
The interpreter can then obtain a set of candidate models that fit the observed data
and present different degrees of isostatic equilibrium.
Tests with synthetic data show the good performance of our method in simultaneously
retrieving the geometry of basement and Moho of a simulated volcanic margin
model. We also applied our method to invert 
gravity data on a profile over the Pelotas basin \citep{stica-etal2014}. This basin is
located at the offshore southern of Brazil and is considered a classical example 
of volcanic passive margin \citep{geoffroy2005}. 
We inverted gravity data provided by the combined global gravity field model EIGEN-6C4
\citep{forste2014}, one of the latest releases of the ``European Improved Gravity model of 
the Earth by New techniques" series, containing the complete gravity gradient data of the 
GOCE-Mission.
Our results are very consistent with a previous
interpretation presented by \citet{zalan2015}, who used ultra-deep seismic data.
These results show that, combined with a priori information, our method can be very effective in 
estimating a set of candidate models having different degrees of isostatic equilibrium at
areas with abrupt crustal thinning, which is typically the case along volcanic passive margins.


\section{Methodology}


\subsection{Forward problem}


Let $\mathbf{d}^{o}$ be the observed data vector, whose $i$-th element $d^{o}_{i}$, 
$i = 1, \dots, N$, represents the observed gravity disturbance at the point 
$(x_{i}, y_{i}, z_{i})$, on a profile located over a rifted passive margin. The
coordinates are referred to a topocentric Cartesian system, with $z$ axis pointing
downward, $y$-axis along the profile and $x$-axis perpendicular to the profile. 
In local- and regional-scale studies, the gravity disturbance \citep{heiskanen-moritz1967} 
represents the vertical component of the gravitational attraction exerted by the gravity 
sources. It is more appropriated for geophysical applications 
\citep{li2001, fairhead2003, hackney-featherstone2003, hinze2005, vajda-etal2006, vajda-etal2007}
and is numerically similar to the classical free-air anomaly.

The density distribution in a rifted margin can be very complex.
In volcanic margins, for example, the crust can be heavily intruded with
flood-basalts and tuffs, which are commonly imaged as Seaward Dipping Reflectors (SDR).
Underneath this intruded crust, high-velocity seismic zones are usually interpreted 
as bodies of underplated mafic to ultra-mafic magma \citep{geoffroy2005}.
We assume that the actual mass distribution in a rifted passive margin can be 
schematically represented according to Figure~\ref{fig:rifted-margin-model}. 
In this model, the subsurface is formed by four layers. 
Layer 1 is the shallowest and represents a water layer with constant density
$\rho^{(w)}$. 
Layer 2 is formed by $Q$ vertically adjacent sub-layers representing 
sediments, salt or volcanic rocks.
In our example, this layer is formed by two sub-layers with constant densities
$\rho^{(q)}$, $q = 1, 2$. Different models can be created by changing the number $Q$
according to the complexity and available a priori information at the study area.
In many cases, seismic data can be used to constrain the geometry of these 
shallow structures.
Layer 3 represents the crust and we presume that its density $\rho^{c}$
varies horizontally along the profile, according to a predefine function.
In Figure \ref{fig:rifted-margin-model}, we consider that crust density assumes 
two possible values. It can be equal to $\rho^{(cc)}$, which
represents the continental crust, or equal to $\rho^{(oc)}$, which represents the
oceanic crust.
However, more complex functions representing the crust density distribution can be
specified according to interpreter's knowledge about the geology at study area.
This approach presumes that bulk values can be used 
to approximate the real density distribution at the deeper parts of crust. 
Finally, Layer 4 represents a homogeneous mantle with constant density $\rho^{(m)}$. 
The surface separating the Layers 1 and 2 defines the basement relief whereas
that separating Layers 3 and 4 defines the Moho. These surfaces are
represented as dashed-white lines in Figure~\ref{fig:rifted-margin-model}.
%We also presume the existence of an compensation depth at $S_{0}$ 
%(continuous black line in Figure~\ref{fig:rifted-margin-model}),
%below which there is no lateral density variations.

In order to define the anomalous mass distribution producing the observed gravity
disturbance, we presume a reference mass distribution formed by two 
layers. The shallowest represents a homogeneous crust with constant
density $\rho^{(r)}$. Its thickness is schematically represented in
Figure~\ref{fig:rifted-margin-model}.
The deepest layer in the reference mass distribution represents a homogeneous mantle
with constant density $\rho^{(m)}$. Notice that the mantle in the reference mass 
distribution has the same density as the mantle in our rifted margin model
(Figure~\ref{fig:rifted-margin-model}).
The surface separating the crust and mantle in the reference mass distribution 
is conveniently called \textit{reference Moho} (Figures~\ref{fig:rifted-margin-model} 
and \ref{fig:interpretation-model}).
The reference model can be thought of as the outer layers of a concentric
mass distribution producing the normal gravity field.
In a local scale, this concentric mass distribution can be approximated by a 
stack of two Bouguer slabs.

We consider that the anomalous mass distribution producing the observed data
is defined as the difference between the rifted margin model 
and the reference mass distribution (Figure~\ref{fig:rifted-margin-model}).
As a consequence, the anomalous mass distribution is characterized by regions
with constant density contrasts.
This anomalous distribution is approximated by an interpretation model 
formed by $N$ columns of vertically stacked prisms 
(Figure~\ref{fig:interpretation-model}).
For convenience, we presume that there is an observed gravity disturbance over the
center of each column.
We consider that the prisms in the extremities of the interpretation model extend to
infinity along the $y$ axis in order to prevent edge effects in the forward 
calculations. 
The $i$-th column is formed by vertically stacked prisms having infinite length along 
the $x$-axis and locally approximates the four layers of our rifted margin model
(Figure~\ref{fig:rifted-margin-model}).

Layer 1 is defined by a single prism, has thickness $t^{(w)}_{i}$ and a constant density
contrast $\Delta \rho^{(w)} = \rho^{(w)} - \rho^{(r)}$.
Layer 2 is defined by the interpreter, according to the complexity of the study area 
and the available a priori information, by a set of $Q$ vertically stacked
prisms, each one with thickness $t^{(q)}_{i}$ and constant density contrast
$\Delta \rho^{(q)} = \rho^{(q)} - \rho^{(r)}$, $q = 1, \dots Q$.
Layer 3 represents the deeper part of the crust, it is also formed by a single prism,
has thickness $t^{(c)}_{i}$ and density contrast 
$\Delta \rho^{(c)}_{i} = \rho^{(c)}_{i} - \rho^{(r)}$, 
with $\rho^{(c)}_{i}$ being the crust density at the coordinate
$y_{i}$, $i = 1, \dots, N$, along the profile.
According to Figure~\ref{fig:interpretation-model}, the crust density contrast
$\Delta \rho^{(c)}_{i}$ may assume two possible values, depending on its position
with respect to the $y_{COT}$.
More complex models can be set by the interpreter according to the available
a priori information at the study area.
The top and bottom of this layer define, respectively, the basement and Moho. 
Finally, Layer 4 representing the mantle is divided into two sub-layers, each one formed
by a single prism having the same constant density contrast 
$\Delta \rho^{(m)} = \rho^{(m)} - \rho^{(r)}$. The shallowest sub-layer 
has thickness $t^{(m)}_{i}$. Its top and bottom define,
respectively, the depths of Moho and the compensation depth $S_{0}$.
The deepest sub-layer has thickness $\Delta S$, top at $S_{0}$ and bottom at 
$S_{0} + \Delta S$, which defines the reference Moho. 

Given the density contrasts, the COT position $y_{COT}$, the compensation
depth $S_{0}$, the thickness $t^{(w)}_{i}$ of the prisms defining Layer 1 and 
also the thickness $t^{(q)}_{i}$, $i = 1 \dots, N$, of the prisms forming the 
upper $Q-1$ sub-layers of Layer 2, it is possible to describe the interpretation
model in terms of an $M \times 1$ parameter vector $\mathbf{p}$, $M = 2N + 1$, defined
as follows:
\begin{equation}
\mathbf{p} = \begin{bmatrix}
\mathbf{t}^{Q} \\
\mathbf{t}^{m} \\
\Delta S
\end{bmatrix} \: ,
\label{eq:parameter-vector}
\end{equation}
where $\mathbf{t}^{Q}$ and $\mathbf{t}^{m}$ are $N \times 1$ vectors whose $i$-th
elements $t^{Q}_{i}$ and $t^{m}_{i}$ represent the thickness of the
prisms forming, respectively, the base of Layer 2 and the top of Layer 4.
Notice that $t^{Q}_{i}$ and $t^{m}_{i}$, $i = 1, \dots, N$, approximate, respectively, the 
geometries of basement and Moho and $\Delta S$ defines the depth of the
reference Moho (Figure~\ref{fig:interpretation-model}).
In this case, the gravity disturbance produced by the interpretation model (the
predicted gravity disturbance) at the position $(x_{i}, y_{i}, z_{i})$ can be written
as the sum of the vertical component of the gravitational attraction exerted by the $L$
prisms forming the interpretation model as follows:
\begin{equation}
d_{i}(\mathbf{p}) = k_{g} \, G \, \sum_{j = 1}^{L} f_{ij}(\mathbf{p}) \: ,
\label{eq:ith-predicted-data}
\end{equation}
where $f_{ij}(\mathbf{p})$ represents an integral over the volume of the $j$-th 
prism. Here, these volume integrals are computed with the expressions proposed 
by \citet{nagy-etal2000}, by using the open-source Python package 
\textit{Fatiando a Terra} \citep{uieda-etal2013}.


\subsection{Inverse problem formulation}


Let $\mathbf{d}(\mathbf{p})$ be the predicted data vector, whose $i$-th element
$d_{i}(\mathbf{p})$ is the vertical component of the gravitational attraction
(equation~\ref{eq:ith-predicted-data}) exerted by the interpretation model
at the position $(x_{i}, y_{i}, z_{i})$ on the profile.
We estimate a particular parameter vector producing a predicted data
$\mathbf{d}(\mathbf{p})$ as close as possible to the observed data 
$\mathbf{d}^{o}$ by minimizing the goal function
\begin{equation}
\Gamma (\mathbf{p}) = \Phi(\mathbf{p}) + \sum_{\ell = 0}^{3} \alpha_{\ell}
\Psi_{\ell}(\mathbf{p}) \: ,
\label{eq:goal-function}
\end{equation}
subject to the inequality constraint 
\begin{equation}
p_{j}^{min} < p_{j} < p_{j}^{max} \: , \quad j = 1, \dots, M \: ,
\label{eq:inequality-constraint}
\end{equation}
where $p_{j}^{min}$ and $p_{j}^{max}$ define, respectively, lower and upper bounds 
for the $j$-th element of $\mathbf{p}$.
In equation~\ref{eq:goal-function}, $\alpha_{\ell}$ is the weight assigned to the 
$\ell$-th regularizing function $\Psi_{\ell}(\mathbf{p})$, $\ell = 0, 1, 2, 3$, and
$\Phi(\mathbf{p})$ is the misfit function given by
\begin{equation}
\Phi(\mathbf{p}) = \frac{1}{N} \| \mathbf{d}^{o} - \mathbf{d}(\mathbf{p}) \|_{2}^{2} 
\: , 
\label{eq:misfit-function}
\end{equation}
where $\| \cdot \|_{2}^{2}$ represents the squared Euclidean norm. 
Notice that our method estimates the parameter vector $\mathbf{p}$ 
(equation~\ref{eq:parameter-vector}), which contains the geometries of 
basement and Moho, as well as the thickness $\Delta S$ defining
the depth of the reference Moho (Figure~\ref{fig:interpretation-model}).
The geometries of Layer 1 and of the upper sub-layers forming Layer 2, as well as the 
compensation depth $S_{0}$ (Figure~\ref{fig:interpretation-model}) are predefined by 
using the bathymetry and the available a priori information. 
These predefined quantities remain fixed during the inversion.
Details about the regularizing functions $\Psi_{\ell}(\mathbf{p})$, $\ell = 0, 1, 2, 3$ 
and the numerical procedure to solve this nonlinear inverse problem are given in the 
following sections.


\subsection{Isostatic constraint}

Consider that no vertical forces are acting on the lateral surfaces of 
each column forming the model (Figure \ref{fig:interpretation-model}). In this case, 
the lithostatic stress (pressure) exerted by the $i$-th column at the surface $S_{0}$
can be computed according to the Archimedes' principle as follows:
\begin{equation}
t^{(w)}_{i} \rho^{(w)} + t^{(1)}_{i} \rho^{(1)}_{i} + \dots + 
t^{(Q)}_{i} \rho^{(Q)}_{i} + t^{(c)}_{i} \rho^{(c)}_{i} + t^{(m)}_{i} \rho^{(m)} 
= \tau_{i} \: ,
\label{eq:lithostatic-stress-densities}
\end{equation}
where $\tau_{i}$ is the ratio of lithostatic stress to the mean gravity 
value on the study area.
By rearranging terms in equation~\ref{eq:lithostatic-stress-densities} 
and using the relation
\begin{equation}
S_{0} = t^{(w)}_{i} + t^{(1)}_{i} + \dots + t^{(Q)}_{i} + t^{(c)}_{i} + t^{(m)}_{i} \: ,
\label{eq:S0}
\end{equation}
it is possible to show that:
\begin{equation}
\Delta \tilde{\rho}^{(Q)}_{i} \, t^{(Q)}_{i} + 
\Delta \tilde{\rho}^{(m)}_{i} \, t^{(m)}_{i} + 
\Delta \tilde{\rho}^{(w)}_{i} \, t^{(w)}_{i} + 
\Delta \tilde{\rho}^{(1)}_{i} \, t^{(1)}_{i} +
\dots + 
\Delta \tilde{\rho}^{(Q-1)}_{i} \, t^{(Q-1)}_{i} +
\rho^{(c)}_{i} \, S_{0} = \tau_{i} \: ,
\label{eq:lithostatic-stress-density-contrasts}
\end{equation}
where $\Delta \tilde{\rho}^{(\alpha)}_{i} = \rho^{(\alpha)}_{i} - \rho^{(c)}_{i}$, 
$\alpha = w, 1, \dots, Q-1, Q, m$.
In order to describe the lithostatic stress exerted by all columns forming the
interpretation model on the surface $S_{0}$, 
equation~\ref{eq:lithostatic-stress-density-contrasts} 
can be written as follows:
\begin{equation}
\mathbf{M}^{(Q)} \mathbf{t}^{(Q)} + \mathbf{M}^{(m)} \mathbf{t}^{(m)} + \mathbf{M}^{(w)}
\mathbf{t}^{(w)} + \mathbf{M}^{(1)} \mathbf{t}^{(1)} + \dots + \mathbf{M}^{(Q-1)}
\mathbf{t}^{(Q-1)} + \boldsymbol{\rho}^{(c)} S_{0} = \boldsymbol{\tau} \: ,
\label{eq:lithostatic-stress-matrix}
\end{equation}
where $\boldsymbol{\tau}$ is an $N \times 1$ vector whose $i$-th element is
the $\tau_{i}$ (equation~\ref{eq:lithostatic-stress-densities}) associated with
the $i$-th column; $\mathbf{t}^{(\alpha)}$, $\alpha = w, 1, \dots, Q-1, Q, m$, 
is an $N \times 1$ vector with $i$-th element defined by the thickness 
$t^{(\alpha)}_{i}$ of a prism in the $i$-th column; $\mathbf{M}^{(\alpha)}$ is an $N \times N$ diagonal 
matrix whose elements are defined by the density contrasts 
$\Delta \tilde{\rho}^{(\alpha)}_{i}$, $i = 1, \dots, N$, of the prisms in a layer and
$\boldsymbol{\rho}^{(c)}$ is an $N \times 1$ vector containing the densities of the prisms
representing the crust. 

Let us now use an approach similar to that presented by \citet{ferderer-etal2017}
to combine the Airy-Heiskanen and Pratt-Hayford models \citep{heiskanen-moritz1967} 
in order to impose local isostatic equilibrium.
We impose this condition by varying both density and geometry of the crust along the 
rifted margin.
In this case, the lithostatic stress exerted by the interpretation model
must be constant at the compensation depth $S_{0}$
(Figure \ref{fig:interpretation-model}).
Differently from previous approaches in literature, we impose isostatic equilibrium 
by forcing the lithostatic stress to be smooth at $S_{0}$.
We apply the first-order Tikhonov regularization
\citep{aster-etal2005} to the vector $\boldsymbol{\tau}$
(equation~\ref{eq:lithostatic-stress-matrix}), obtaining the
following expression:
\begin{equation}
\mathbf{R} \left( \mathbf{C} \mathbf{p} + \mathbf{D} \mathbf{t} \right) = \mathbf{0} 
\: ,
\label{eq:tik1-lithostatic-stress}
\end{equation}
where $\mathbf{0}$ is a vector with null elements and the remaining terms are given by:
\begin{equation}
\mathbf{C} = \begin{bmatrix}
\mathbf{M}^{(Q)} & \mathbf{M}^{(m)} & \mathbf{0}
\end{bmatrix}_{N \times M} \: ,
\label{eq:matrix-C}
\end{equation}
\begin{equation}
\mathbf{D} = \begin{bmatrix}
\mathbf{M}^{(w)} & \mathbf{M}^{(1)} & \cdots & \mathbf{M}^{(Q-1)} &
\boldsymbol{\rho}^{(c)}
\end{bmatrix}_{N \times \left( QN + 1 \right)} \: ,
\label{eq:matrix-D}
\end{equation}
\begin{equation}
\mathbf{t} = \begin{bmatrix}
\mathbf{t}^{(w)} \\ \mathbf{t}^{(1)} \\ \vdots \\ \mathbf{t}^{(Q-1)} \\ S_{0}
\end{bmatrix}_{\left( QN + 1 \right) \times 1}\: ,
\label{eq:vector-t}
\end{equation}
and $\mathbf{R}$ is an $\left( N-1 \right) \times N$ matrix, whose element 
$ij$ is defined as follows:
\begin{equation}
\left[ \mathbf{R} \right]_{ij} = \begin{cases}
1 &, \quad j = i \\
-1 &, \quad j = i + 1 \\
0 &, \quad \text{otherwise}
\end{cases} \quad .
\label{eq:matrix-R}
\end{equation}
Finally, from equation~\ref{eq:tik1-lithostatic-stress}, it is possible to
define the regularizing function $\Psi_{0}(\mathbf{p})$ 
(equation~\ref{eq:goal-function}): 
\begin{equation}
\Psi_{0}(\mathbf{p}) = \| \mathbf{W} \, \mathbf{R} \left( \mathbf{C} \mathbf{p} + \mathbf{D}
\mathbf{t} \right) \|_{2}^{2} \: ,
\label{eq:isostatic-constraint-function}
\end{equation}
where $\mathbf{W}$ is an $(N - 1) \times (N - 1)$ diagonal matrix having constant
elements $0 < w_{ii} \le 1$, $i = 1, \dots, N - 1$. 
Function $\Psi_{0}(\mathbf{p})$ defines the \textit{Isostatic constraint}.

Notice that, by minimizing the function $\Psi_{0}(\mathbf{p})$ 
(equation~\ref{eq:isostatic-constraint-function}), the method imposes smoothness on 
the lithostatic stress exerted by the interpretation model on the 
compensation depth $S_{0}$.
Matrix $\mathbf{W}$ controls the relative amount of isostatic equilibrium imposed 
along the profile. 
In the particular case in which all diagonal elements $w_{ii}$ have the same
constant value, the same amount of isostatic equilibrium is imposed along the 
whole profile. On the other hand, different amounts of isostatic equilibrium
can be imposed along the profile by varying the values of these elements.
Elements $w_{ii} \approx 1$ impose a smooth lithostatic stress curve 
at the transition between columns $i$ and $i+1$ of the interpretation model.
Elements $w_{ii} \approx 0$ allow abrupt variations in the lithostatic stress 
curve between columns $i$ and $i+1$ of the interpretation model.
By using all elements $w_{ii} = 1$, we impose full isostatic equilibrium 
along the entire profile. Alternatively, we may enable the interpretation model 
to deviate from the isostatic equilibrium by conveniently decreasing the numerical values
assigned to the elements $w_{ii}$ at specific regions along the profile. 
The strategy used to define the elements $w_{ii}$ is 
presented in the specific section describing the computational procedures
for solving the inverse problem.


\subsection{Smoothness constraint}


This constraint imposes smoothness on the adjacent thickness of the prisms forming the
base of Layer 2 and the top of Layer 4. 
This information is introduced by applying the first-order Tikhonov regularization
\citep{aster-etal2005} to the vectors $\mathbf{t}^{(Q)}$ and $\mathbf{t}^{(m)}$ 
(equation~\ref{eq:parameter-vector}). 
Mathematically, this constraint is represented by the regularizing function
$\Psi_{1}(\mathbf{p})$ (equation~\ref{eq:goal-function}):
\begin{equation}
\Psi_{1}(\mathbf{p}) = \| \mathbf{S}\mathbf{p} \|_{2}^{2} \: ,
\label{eq:smootheness-contraint}
\end{equation}
where $\mathbf{S}$ is an $2 \left( N-1 \right) \times M$ matrix given by:
\begin{equation}
\mathbf{S} = \begin{bmatrix}
\mathbf{R} & \mathbf{0} & \mathbf{0} \\
\mathbf{0} & \mathbf{R} & \mathbf{0}
\end{bmatrix} \: ,
\label{eq:matrix-S}
\end{equation}
where $\mathbf{R}$ is defined by equation~\ref{eq:matrix-R} and $\mathbf{0}$
are matrices with all elements equal to zero.


\subsection{Equality constraints}

In order to incorporate a priori information at isolated points on the basement
and Moho surfaces, we use an approach similar to those proposed by
\citet{barbosa-etal1997} and \citet{barbosa-etal1999b}. 

\subsubsection*{Equality constraint on vector $\mathbf{t}^{Q}$}

Let $\mathbf{a}$ be a vector whose $k$-th element $a_{k}$,
$k = 1, \dots, A$, is the difference between a known basement depth and
the sum of the thickness of the upper parts of the interpretation model
(water layer and the upper sub-layers of Layer 2), all at the same
horizontal coordinate $y^{A}_{k}$ of the profile. 
These differences, which must be positive, are used to define 
the regularizing function $\Psi_{2}(\mathbf{p})$ 
(equation~\ref{eq:goal-function}):
\begin{equation}
\Psi_{2}(\mathbf{p}) = \| \mathbf{A}\mathbf{p} - \mathbf{a} \|_{2}^{2} \: ,
\label{eq:equality-constraint-basement}
\end{equation}
where $\mathbf{A}$ is an $A \times M$ matrix whose $k$-th line has one element 
equal to one and all the remaining elements equal to zero. The location of the
single non-null element in the $k$-th line of $\mathbf{A}$ depends on the coordinate
$y^{A}_{k}$ of the known thickness $a_{k}$. Let us consider, 
for example, an interpretation model formed by $N = 10$ columns. Consider also that 
the thickness of the deepest sub-layer of Layer 2  
at the coordinates $y^{A}_{1} = y_{4}$ and $y^{A}_{2} = y_{9}$ 
are equal to $25$ and $35.7$ km, respectively. In this case, $A = 2$,
$\mathbf{a}$ is a $2 \times 1$ vector with elements $a_{1} = 25$ and $a_{2} = 35.7$
and $\mathbf{A}$ is a $2 \times M$ matrix ($M = 2N + 1 = 21$). The element $4$ of the
first line and the element $9$ of the second line of $\mathbf{A}$ are equal to $1$ and
all its remaining elements are equal to zero.

\subsubsection*{Equality constraint on vector $\mathbf{t}^{m}$}

Let $\mathbf{b}$ be a vector whose $k$-th element $b_{k}$,
$k = 1, \dots, B$, is the difference between the compensation depth
$S_{0}$ and the known Moho depth at the horizontal coordinate $y^{B}_{k}$ of the
profile. These differences, which must be positive, define known thickness values
of the upper part of Layer 4. These values are used to define the 
regularizing function $\Psi_{3}(\mathbf{p})$ (equation~\ref{eq:goal-function}):
\begin{equation}
\Psi_{3}(\mathbf{p}) = \| \mathbf{B}\mathbf{p} - \mathbf{b} \|_{2}^{2} \: ,
\label{eq:equality-constraint-moho}
\end{equation}
where $\mathbf{B}$ is a $B \times M$ matrix whose $k$-th line has one element 
equal to one and all the remaining elements equal to zero. This matrix is defined 
in the same way as matrix $\mathbf{A}$ (equation~\ref{eq:equality-constraint-basement}).


\subsection{Computational procedures for solving of the inverse problem}

The parameter vector $\mathbf{p}$ (equation~\ref{eq:parameter-vector}) minimizing the
goal function $\Gamma (\mathbf{p})$ (equation~\ref{eq:goal-function}), subjected to
the inequality constraint (equation~\ref{eq:inequality-constraint}), is estimated 
in three steps. At each step, the goal function is minimized by using the Levenberg-Marquardt 
method \citep{silva-etal2001, aster-etal2005} and the inequality constraint 
(equation~\ref{eq:inequality-constraint}) is incorporated by using the same strategy 
employed by \citet{barbosa-etal1999}.
All derivatives of the misfit function $\Phi(\mathbf{p})$ (equation~\ref{eq:misfit-function})
with respect to the parameters are computed by using a finite difference approximation.

\subsubsection{General description of Step 1 (S1)}

Step 1 consists in solving the inverse problem without imposing the isostatic
constraint, by using $\alpha_{0} = 0$ (equation \ref{eq:goal-function}). For this step,
the interpreter must set:
\begin{itemize}
	\item \underline{Parameters defining the interpretation model
	(Figure~\ref{fig:interpretation-model}):} density contrasts $\Delta \rho^{(\alpha)}$, 
	$\alpha = w, 1, \dots, Q, cc, oc, m$, of the four layers, COT position $y_{COT}$ and
	isostatic compensation depth $S_{0}$. Figure \ref{fig:interpretation-model} illustrates 
	the case in which the second layer is formed by $Q = 2$ parts. This number, however, 
	can be changed according to the study area.
	\item \underline{Parameters for the inversion:} weights $\alpha_{\ell}$,
	$\ell = 1, 2, 3$ (equation~\ref{eq:goal-function}), associated to the 
	smoothness and equality constraints (equations \ref{eq:smootheness-contraint},
	\ref{eq:equality-constraint-basement} and \ref{eq:equality-constraint-moho}),
	lower and upper bounds $p_{j}^{min}$ and $p_{j}^{max}$
	(equation~\ref{eq:inequality-constraint}), $j = 1, \dots, M$,
	for the parameters to be estimated, vectors $\mathbf{a}$ 
	(equation~\ref{eq:equality-constraint-basement}) and $\mathbf{b}$
	(equation~\ref{eq:equality-constraint-moho}) containing known thickness values
	and an initial approximation $\mathbf{p}^{(0)}$ for the parameter vector $\mathbf{p}$
	(equation~\ref{eq:parameter-vector}). The initial approximation $\mathbf{p}^{(0)}$
	must satisfy the inequality constraints (equation~\ref{eq:inequality-constraint}).
\end{itemize}
The estimated parameter vector obtained at the end of this first step is conveniently called
$\mathbf{p}^{(1)}$. The main goal in this step is finding suitable values for the parameters
defining the interpretation model and those used for inversion. Several trials may be
necessary to find suitable values for these parameters.

\subsubsection{General description of Step 2 (S2)}

Step 2 consists in obtaining an estimated parameter vector $\mathbf{p}^{(2)}$
by imposing full isostatic equilibrium on the interpretation model along the entire profile.
In this step, the interpreter must use the same initial approximation $\mathbf{p}^{(0)}$
of the previous step. 
Additionally, the interpreter must set the matrix $\mathbf{W}$
equal to the identity and find a suitable value for the weight $\alpha_{0}$ 
(equation \ref{eq:goal-function}) controlling the isostatic constraint 
(equation~\ref{eq:isostatic-constraint-function}).
We presume that, by imposing full isostatic equilibrium along the entire profile,
the estimated parameter vector $\mathbf{p}^{(2)}$ will produce a mostly good data fit,
except at some isolated regions. 
We assume that, at these regions, the passive margin to deviate
from the isostatic equilibrium described by the Airy-Heiskanen model.

\subsubsection{General description of Step 3 (S3)}

Step 3 consists in obtaining an estimated parameter vector $\mathbf{p}^{(3)}$
by imposing different amounts of isostatic equilibrium on the interpretation model along the
profile. At this step, the interpreter must compute the diagonal elements 
$w_{ii}$ of the matrix $\mathbf{W}$ (equation~\ref{eq:isostatic-constraint-function}) 
in order to enable the interpretation model to deviate from isostatic equilibrium in 
the regions presenting large residuals. 
The elements of $\mathbf{W}$ are computed as follows:
\begin{equation} \label{eq:elements-wii}
w_{ii} = 
\exp \left[ - \frac{ \left( r_{i}^{(2)} + r_{i+1}^{(2)} \right)^{2}}{4 \sigma} \right] \: ,
\end{equation}
where $\sigma$ is a positive constant, $\mathbf{p}^{(2)}$ is the estimated parameter vector
obtained in the previous step and the variables
$r_{i}^{(2)} = d^{o}_{i} - d_{i} \left( \mathbf{p}^{(2)} \right)$ and 
$r_{i+1}^{(2)} = d^{o}_{i+1} - d_{i+1} \left(\mathbf{p}^{(2)} \right)$ represent,
respectively, the residuals between observed and predicted data
(equation~\ref{eq:ith-predicted-data}) at the positions $(x_{i}, y_{i}, z_{i})$ and 
$(x_{i+1}, y_{i+1}, z_{i+1})$. Notice that equation~\ref{eq:elements-wii} defines elements 
$w_{ii}$ in the interval $\left] 0, 1 \right]$. Additionally, this equation results in 
$w_{ii} \approx 1$ at regions where the residuals are close to zero and 
$w_{ii} \approx 0$ at regions presenting large residuals.
The positive constant $\sigma$ controls the deviation from isostatic equilibrium.
Small $\sigma$ values allow large deviations from isostatic equilibrium,
resulting in estimated models close to that obtained at Step 1.
Large $\sigma$ values allow small deviations from isostatic equilibrium,
resulting in estimated models close to that obtained at Step 2.
This strategy to define the elements of matrix $\mathbf{W}$ 
(equation\ref{eq:isostatic-constraint-function}) presumes that the isostatic constraint may
produce large residuals at some regions along the profile. To counteract this problem,
our method enables the interpretation model to deviate from isostatic equilibrium at these 
regions. This idea is in agreement with the fact that the isostatic equilibrium at 
passive rifted margin cannot be totally explained by local models.

\subsubsection{Considerations about the weights $\alpha_{0}$, $\alpha_{1}$, $\alpha_{2}$ and $\alpha_{3}$}

Other important aspect of our method is related to the values attributed to 
the weights $\alpha_{\ell}$ (equation~\ref{eq:goal-function}).
Their values can be very dependent on the particular characteristics of the 
interpretation model and there is no analytical rule to define them. 
To overcome this problem, we normalize the $\alpha_{\ell}$ values as follows:
\begin{equation}
\alpha_{\ell} = \tilde{\alpha}_{\ell} \, \frac{E_{\Phi}}{E_{\ell}} \: 
, \quad \ell = 0, 1, 2, 3 \: ,
\label{eq:constraint-weights}
\end{equation}
where $\tilde{\alpha}_{\ell}$ is a positive scalar and $E_{\Phi} / E_{\ell}$
is a normalizing constant. In this equation, $E_{\ell}$ represents the median 
of the elements forming the main diagonal of the Hessian matrix of the 
$\ell$-th constraining function $\Psi_{\ell}(\mathbf{p})$ 
(equations~\ref{eq:isostatic-constraint-function}, 
\ref{eq:smootheness-contraint}, \ref{eq:equality-constraint-basement} and 
\ref{eq:equality-constraint-moho}). The constant $E_{\Phi}$ is defined in 
a similar way by using the Hessian matrix of the misfit function $\Phi(\mathbf{p})$ 
(equation~\ref{eq:misfit-function}) computed with 
the initial approximation $\mathbf{p}^{(0)}$ for the parameter vector $\mathbf{p}$ 
(equation~\ref{eq:parameter-vector}) at the first step.
According to this empirical strategy, the weights $\alpha_{\ell}$ are defined 
by using the positive scalars $\tilde{\alpha}_{\ell}$ 
(equation \ref{eq:constraint-weights}), which are less dependent on the particular 
characteristics of the interpretation model.

\subsubsection{Summarized version of our algorithm}

\begin{enumerate}
	\item [\textbf{(S1)}] Use $\tilde{\alpha}_{0} = 0$ and set non-null values for 
	$\tilde{\alpha}_{1}$, $\tilde{\alpha}_{2}$ and $\tilde{\alpha}_{3}$ 
	(equation~\ref{eq:constraint-weights})
	(see the subsection \textit{Practical considerations}).
	Define $p_{j}^{min}$, $p_{j}^{max}$ (equation~\ref{eq:inequality-constraint}),
	$\mathbf{a}$ (equation~\ref{eq:equality-constraint-basement}) and
	$\mathbf{b}$ (equation~\ref{eq:equality-constraint-moho}).
	Define an initial approximation $\mathbf{p}^{(0)}$ satisfying the inequality constraint
	(equation~\ref{eq:inequality-constraint}). Use $\mathbf{p}^{(0)}$ to compute the 
	Hessian matrix of the misfit function $\Phi(\mathbf{p})$ (equation~\ref{eq:misfit-function}).
	Compute the Hessian matrices of the constraining functions $\Psi_{\ell}(\mathbf{p})$, 
	$\ell = 1, 2, 3$ (equations \ref{eq:smootheness-contraint},
	\ref{eq:equality-constraint-basement} and \ref{eq:equality-constraint-moho}). 
	Compute $E_{\Phi}$, $E_{\ell}$ and $\alpha_{\ell}$
	(equation~\ref{eq:constraint-weights}), $\ell = 1, 2, 3$. 
	Estimate a parameter vector $\mathbf{p}^{(1)}$
	minimizing $\Gamma(\mathbf{p})$ (equation~\ref{eq:goal-function}), 
	subject to the inequality constraint (equation~\ref{eq:inequality-constraint}).
	\item [\textbf{(S2)}] Use the same initial approximation $\mathbf{p}^{(0)}$
	of the previous step. Set $\mathbf{W}$ (equation~\ref{eq:isostatic-constraint-function})
	equal to identity. Set a non-null value for $\tilde{\alpha}_{0}$
	(equation~\ref{eq:constraint-weights})
	(see the subsection \textit{Practical considerations}).
	Compute the Hessian matrix of the constraining function $\Psi_{0}(\mathbf{p})$
	(equation~\ref{eq:isostatic-constraint-function}).
	Compute $E_{0}$ and $\alpha_{0}$ (equation~\ref{eq:constraint-weights}).
	Estimate a parameter vector $\mathbf{p}^{(2)}$ minimizing $\Gamma(\mathbf{p})$ 
	(equation~\ref{eq:goal-function}), subject to the inequality constraint 
	(equation~\ref{eq:inequality-constraint}).
	\item [\textbf{(S3)}] Use $\mathbf{p}^{(2)}$ as initial approximation.
	Set the positive constant $\sigma$ 
	(see the subsection \textit{Practical considerations}) and compute the 
	diagonal elements $w_{ii}$ (equation~\ref{eq:elements-wii}), $i = 1, \dots N-1$.
	With the new $\mathbf{W}$, compute the Hessian matrix of the constraining function
	$\Psi_{0}(\mathbf{p})$ (equation~\ref{eq:isostatic-constraint-function}).
	Estimate a parameter vector $\mathbf{p}^{(3)}$ minimizing $\Gamma(\mathbf{p})$ 
	(equation~\ref{eq:goal-function}), subject to the inequality constraint 
	(equation~\ref{eq:inequality-constraint}).
\end{enumerate}


\subsubsection*{Practical considerations}

Our algorithm depends on several parameters that significantly impact the estimated models
and cannot be automatically set without the interpreterâ€™s judgment.
They are the parameters $\tilde{\alpha}_{1}$, $\tilde{\alpha}_{2}$ and $\tilde{\alpha}_{3}$
(set at Step 1), $\tilde{\alpha}_{0}$ (set at Step 2) and 
$\sigma$ (set at Step 3).
Based on our practical experience, we suggest
some empirical procedures for setting these parameters at each step of our algorithm.

At Step 1, set $\tilde{\alpha}_{1} = 0$ and try different positive values for 
$\tilde{\alpha}_{2}$ and $\tilde{\alpha}_{3}$. 
These two parameters control the equality constraints
(equations~\ref{eq:equality-constraint-basement} and \ref{eq:equality-constraint-moho})
imposing a priori information at isolated points on the basement and Moho surfaces.
Good guesses are, respectively,
$10^{1}$ and $10^{2}$. Normally, $\tilde{\alpha}_{3}$ is one order of magnitude greater
than $\tilde{\alpha}_{2}$.
The values of $\tilde{\alpha}_{2}$ and $\tilde{\alpha}_{3}$ 
must be the smallest positive numbers resulting in an estimated model with
basement and Moho surfaces close to the values provided by the a priori information
at some isolated points. Notice that this estimated model must be obtained 
by using only the equality constraints. Consequently, there must be some
pinnacles around the points associated with the a priori information. This effect
has already been observed by \citet{barbosa-etal1997}.
By using the chosen values for $\tilde{\alpha}_{2}$ and $\tilde{\alpha}_{3}$, 
try different positive values for $\tilde{\alpha}_{1}$. 
This parameter controls the smoothness of basement and Moho surfaces
(equation~\ref{eq:smootheness-contraint}).
A good guess is $10^{1}$.
This parameter must be the smallest positive number producing an estimated model
satisfying the following criteria: (i) the data fit must be good along the entire profile
and (ii) the pinnacles must be removed. 

At Step 2, try different positive values for $\tilde{\alpha}_{0}$ 
(equation~\ref{eq:constraint-weights}). This parameter
controls the smoothness of the lithostatic stress exerted by the interpretation model
at the compensation depth $S_{0}$. A good guess is $10^{2}$.
Generally, $\tilde{\alpha}_{0}$ is one order of magnitude greater than
$\tilde{\alpha}_{1}$. Large values produce a poor data fit along the profile.
This parameter must be the largest positive number resulting in an estimated
model satisfying two criteria: (i) the lithostatic stress curve must be smooth
along the entire profile and (ii) there must be a good data fit along the entire
profile, except at some isolated regions presenting relatively large residuals.

Finally, at Step 3, try different positive values for $\sigma$ (equation~\ref{eq:elements-wii}).
This parameter controls the deviations of the interpretation model from the
isostatic equilibrium at regions presenting large residuals.
Small values produce estimated models close to that obtained at Step 1.
On the other hand, large values produce estimated models close to that
obtained at Step 2.
This parameter must be set as the largest positive number producing (i) a good data-fit
along the entire profile and (ii) an estimated model different from those obtained
at Steps 1 and 2.
A good practice is to generate a set of estimates by using different values for $\sigma$. 


\section{Applications to synthetic data}


We have simulated a simple volcanic margin model formed by four layers: 
water, sediments + seaward dipping reflectors, crust (continental and oceanic) 
and mantle. 
Parameters defining this model are shown in Table~\ref{tab:volcanic-margin-model}.
By following the algorithm described in the previous section, we inverted the synthetic 
gravity disturbance data produced by our volcanic margin model.

Figure~\ref{fig:volc-margem-step1} shows the results obtained at Step 1 of our
algorithm.
The interpretation model was defined by using the parameters shown in
Table~\ref{tab:volcanic-margin-model}.
The parameters $\tilde{\alpha}_{1}$, $\tilde{\alpha}_{2}$ and 
$\tilde{\alpha}_{3}$ (equation~\ref{eq:constraint-weights}) used at Step 1 
have values $10^{1}$, $10^{1}$ and $10^{2}$, respectively.
Remember that this estimate was obtained without imposing the 
isostatic constraint, by using $\tilde{\alpha}_{0} = 0$.
We assumed $S_{0} = 41$ km and chose an initial approximation for $\Delta S$
equal to $8.5$ km, which corresponds to a reference Moho deeper 
than the true one (Table~\ref{tab:volcanic-margin-model}).
Notice that, not only the initial approximation for the reference Moho,
but also those used for basement and Moho surfaces 
(dashed blue lines) are very different from
the true model (continuous black lines).
As we can see in Figure~\ref{fig:volc-margem-step1}, the estimated Moho and reference 
Moho are very close to the true ones.
On the other hand, the estimated basement is very smooth and present large differences
relative to the true one.
Despite these large differences, 
the predicted gravity disturbance and lithostatic stress 
are very close to the simulated values.
In this example, the good data fit can be explained by the small density contrast at basement
relative to that at Moho.
This small density contrast forces the Moho to play a dominant role in fitting the
lithostatic stress curve and the simulated gravity data.

Figure~\ref{fig:volc-margem-step2} shows the estimated model obtained at the end
of Step 2, by using $\tilde{\alpha}_{0} = 10^{2}$ (equation~\ref{eq:constraint-weights}).
In comparison to the estimated model obtained at Step 1 (Figure~\ref{fig:volc-margem-step1}),
this result shows a very smooth lithostatic stress curve as a consequence of the
isostatic constraint. The use of the isostatic constraint has produced little effect on the
estimated reference Moho and resulted in a worse estimated Moho.
On the other hand, it reduced the large differences between the estimated and 
true basement surfaces. The main improvement occurs along the 
first $\approx 100$ km on the profile, where the true model exhibits a pronounced crustal
thinning. The region between $100$ and $200$ km, however, shows large 
differences between the estimated and true basement. At this region, we can also
notice the presence of large differences between the simulated and predicted gravity
disturbances.

Figures~\ref{fig:volc-margem-step3-sgm22}, \ref{fig:volc-margem-step3-sgm10} and 
\ref{fig:volc-margem-step3-sgm40} show estimated models obtained at
the Step 3 of our algorithm by using different values for the parameter $\sigma$
(equation~\ref{eq:elements-wii}).
In comparison with the estimated model obtained at Step 2 
(Figure~\ref{fig:volc-margem-step2}), the new models 
show better data fits and improved estimates for Moho and reference Moho.
All models show a small artifact at the estimated Moho at the position
$y \approx 150$ km, which shows the large residuals between the predicted
and simulated gravity data in Figure~\ref{fig:volc-margem-step2}. 
This artifact is a consequence of the small density contrast associated 
to basement. This small density contrast forces the Moho to play a dominant role in the inversion.
Notice that the lithostatic stress curves in all these new models reflect, predominantly, 
the geometry of the estimated Moho and are less sensitive to the geometry of basement.
In this case, the small density contrast associated to basement causes our method to concentrate
changes in the Moho surface at the region located between $100$ and $200$ km to improve the data fit.
It is worth noting that, at this region, the new lithostatic stress curves contain abrupt variations
and the estimated models deviate from the isostatic equilibrium.

The main differences between the models shown in 
Figures \ref{fig:volc-margem-step3-sgm22}, \ref{fig:volc-margem-step3-sgm10} and 
\ref{fig:volc-margem-step3-sgm40} occur at basement,
along the first $200$ km of the profile.
According to the practical considerations explained in the previous section, 
we consider that the estimated model shown in Figure~\ref{fig:volc-margem-step3-sgm22},
with $\sigma = 22$, is the best. 
This model presents a good data fit along the entire profile, estimated Moho and
reference Moho very close to the true ones and an estimated basement intermediate
between those obtained at Steps 1 and 2 (Figures~\ref{fig:volc-margem-step1} and
\ref{fig:volc-margem-step2}).
Notice that the estimated model obtained with 
the smallest $\sigma$ (Figure~\ref{fig:volc-margem-step3-sgm10}) is close the that 
obtained at Step 1 (Figure~\ref{fig:volc-margem-step1}).
In this case, the predicted lithostatic stress curve is less smooth than that
produced by the best model.
On the other hand, the estimated model obtained with 
the largest $\sigma$ (Figure~\ref{fig:volc-margem-step3-sgm40}) is close the that 
obtained at Step 2 (Figure~\ref{fig:volc-margem-step2}).
In this case, the predicted lithostatic stress curve is smoother than that
produced by the best model.

Figure~\ref{fig:volc-margem-step3-alternative} shows an alternative 
estimated model obtained at Step 3.
The density values in Layer 2 (sediment + SDR) used to obtain this model 
are different from those of the true model (Table~\ref{tab:volcanic-margin-model}).
The corresponding estimated model obtained at Step 1 is not shown and
that obtained at Step 2 is represented by the dashed blue lines in
Figure~\ref{fig:volc-margem-step3-alternative}.
Notice that the absolute value of the density contrast associated to basement 
in this alternative model is greater than that used to generate the estimated models shown in 
Figures~\ref{fig:volc-margem-step3-sgm22}, \ref{fig:volc-margem-step3-sgm10} and
\ref{fig:volc-margem-step3-sgm40}. As we can see, the artifact shown in the estimated Moho,
at the position $y \approx 150$ km, is considerably smaller in the alternative model than
in the previous ones (Figures~\ref{fig:volc-margem-step3-sgm22}, \ref{fig:volc-margem-step3-sgm10} and
\ref{fig:volc-margem-step3-sgm40}). This result confirms that the artifact shown in the
estimated Moho of the previous models is a consequence of the small density contrast
associated to basement.
Besides, this result shows that our method can produce good estimates of the basement and
Moho surfaces, even by using approximated values for the density contrasts at Layer 2.



\section{Application to real data}

We applied our method to interpret the gravity disturbance data 
on a profile located over the Pelotas basin
\citep{stica-etal2014}, southern of Brazil (Figure \ref{fig:pelotas-location}). This basin is 
considered a classical example of volcanic margin \citep{geoffroy2005}.

The gravity disturbance data are provided by the combined global gravity field model EIGEN-6C4
\citep{forste2014}, one of the latest releases of the ``European Improved Gravity model of 
the Earth by New techniques" series.

We have used data from ETOPO-1 to constraint the bathymetry along the profile
(citar a ref do ETOPO-1).

Additionally, we have used a priori information about the basement and Moho depths
obtained from the seismic interpretation presented by \citet{zalan2015}.

Figure~\ref{fig:pelotas-step3} shows the estimated model obtained at Step 3
of our algorithm, by using $\sigma = 58$ (equation~\ref{eq:elements-wii}), 
$\tilde{\alpha}_{0} = 10^{2}$, $\tilde{\alpha}_{1} = 10^{1}$, 
$\tilde{\alpha}_{2} = 10^{1}$ and $\tilde{\alpha}_{3} = 10^{2}$
(equation~\ref{eq:constraint-weights}).
Parameters defining the interpretation model are the same used
to define our volcanic margin model (Table~\ref{tab:volcanic-margin-model}).
The initial approximation used in Steps 1 and 2 (not shown) was obtained by 
interpreting a seismic section presented by \citet{stica-etal2014}.
As we can see, the estimated model produces a very good data fit along the whole
profile. Our estimated model is very close to that proposed independently by
\citet{zalan2015} (dashed-white lines in Figure~\ref{fig:pelotas-step3}), by
interpreting ultra-deep seismic data.
The larger differences ($\approx 10$ km) occur at the basement, along the first 
$100$ km of the profile.
At this region, \citeauthor{zalan2015} proposes a steep variation in basement
relief, which shows a maximum depth $\approx 30$ km. On the other hand, our result 
shows a smooth variation in basement relief. Despite these large differences,
Figure~\ref{fig:pelotas-step3} shows that our model produces a very good data fit
at this region. It means that, by considering a SDR with small density contrast 
(Table~\ref{tab:volcanic-margin-model}), the steep variation 
proposed by \citeauthor{zalan2015} in the basement relief cannot be determined by 
using only gravity data.
The estimated lithostatic stress curve contains abrupt variations
at an isolated region close to $150$ km and is very smooth on the remaining parts
of the profile. This result suggests that the margin is mostly in isostatic 
equilibrium, except at the region $\approx 150$.

Figure~\ref{fig:pelotas-step3-more-infs} shows an estimated model
obtained in the same way as that shown in Figure~\ref{fig:pelotas-step3},
but by using additional a priori information at basement.
Similarly to that shown in Figure~\ref{fig:pelotas-step3},
the new model (Figure~~\ref{fig:pelotas-step3-more-infs}) produces a very good data fit 
and deviates from the isostatic equilibrium at the position $\approx 150$ km. 
Notice that, by using the additional a priori information, the differences between our model
and that obtained by \citet{zalan2015} decrease considerably without producing
significant changes in the predicted data.
It is worth stressing that our results were obtained by using gravity data
provided by the global gravity model EIGEN6C4 \citep{forste2014}, whereas 
\citet{zalan2015} obtained his result by interpreting ultra-deep seismic sections
available to the petroleum industry.


\section{Conclusions}

We present a new gravity inversion method for simultaneously estimating the 
geometries of basement and Moho, as well as the constant depth of the reference Moho 
on a profile crossing a passive rifted margin.
Our method approximates the subsurface by a set of adjacent columns, each one divided
into four layers. The first one represents water; the second is formed by vertically
stacked parts, according to the complexity of the study area; the third and fourth represent,
respectively, the crust and mantle, being the last one formed by two parts.
The planar surface separating these two parts represents the isostatic compensation depth,
below which there are no lateral density variations.
The surfaces defining the top and bottom of the third layer represent, respectively, 
the basement and Moho in our model.
We assume that the Continent-Ocean Transition (COT) can be represented by an abrupt and 
vertical interface.
The layers representing water and mantle have constant density contrasts.
In the second layer, each part has a constant density contrast.
The density contrast in the third layer assumes two possible values representing
the continental crust, before the COT, and oceanic crust, after the COT.

Our method presumes the knowledge of the COT position, the compensation depth,
all density contrasts and the geometry of all layers above the basement.
In practical situations, 
seismic data commonly constrain the geometry of these shallow layers.
The method is formulated as a nonlinear inverse problem. 
The parameters to be estimated are the thickness of the deeper part forming the 
second layer, which defines the basement, the thickness of the upper part forming the 
fourth layer, which defines the Moho, and the constant thickness of the deeper part forming 
the fourth layer, which defines the reference Moho.
Because all parameters represent thickness, we force them to be positive.
In order to obtain stable solutions, we enforces the estimated basement and Moho to be 
smooth and close to some points with hose depths were estimated independently along the profile.
We also impose isostatic equilibrium according to the Airy-Heiskanen model.
This information is introduced by constraining the lithostatic stress
exerted by the model on a constant compensation depth. The constraint forces the
lithostatic stress to be mostly smooth, except at some isolated regions, where it can
present abrupt variations.

Tests with synthetic data show that the isostatic constraint can considerably improve 
the estimated model at regions showing pronounced crustal thinning, which 
are typical of volcanic passive margins. 
Applications to real data over the Pelotas basin, considered a classical volcanic
margin at the southern of Brazil, produced results in agreement with a previous 
interpretation obtained independently by using ultra-deep seismic data.
These results show that our method can be a useful tool for interpreting
gravity data on rifted margins.

The problem of simultaneously estimating the geometries of basement and Moho surfaces
is very ambiguous and some simplifications must be made. 
One of these simplifications in our method consists in considering bulk density 
values for each column forming the continental and oceanic crusts. 
The interpreter must predefine the function describing the horizontal density
variation of the crust along the profile, including the region 
close the COT.
In most practical situations, however, the interpreter will not have access to a detailed
description of the density variations within the crust and a regional approximation
will have to be used instead.
As a consequence, local errors in the estimated basement and Moho surfaces are expected 
at regions presenting local density variations in the deeper parts of continental crust 
and in the oceanic crust.
Another limitation of our method is that it requires a priori information about the
upper layers located below the ocean bottom.
This information can be obtained, for example, from seismic data and be used to set
the densities of the layers located right below the ocean bottom.
If no a priori information is available at the study area, the interpreter will have to use
approximated values.
Errors in this approximation may negatively impact the estimated model, especially in 
the basement surface.
Further research could be conducted to generalize our method to estimate
three dimensional models and also include lateral density variations in 
the mantle.

%%%%%%%%%%%%%%%%%% Tables %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\tabl{volcanic-margin-model}{Properties of the volcanic margin model. 
	The model extends from $y = 0$ km to $y = 383$ km, the Continent-Ocean 
	Transition (COT) is located at $y_{COT} = 350$ km and the reference 
	Moho is located at $43 \, 200$ km (Figures~\ref{fig:rifted-margin-model} and 
	\ref{fig:interpretation-model}).
	The density contrasts $\Delta\rho^{(\alpha)}$ are defined with respect to the
	reference value $\rho^{(r)} = 2870$ kg/m$^{3}$, which coincides with
	the density $\rho^{(cc)}$ attributed to the continental crust.
	\label{tab:volcanic-margin-model}
}{
\begin{center}
	\begin{tabular}[]{lccc}
		\hline
		\textbf{Geological meaning} & $\rho^{(\alpha)}$ (kg/m$^{3}$) & $\Delta\rho^{(\alpha)}$ (kg/m$^{3}$) & $\alpha$ \\
		\hline
		water & $1030$ & $-1840$ & $w$ \\
		\hline
		sediments & $2350$ & $-520$ & $1$ \\
		SDR & $2855$ & $-15$ & $2$ \\
		\hline 
		continental crust & $2870$ & $0$ & $cc$ \\
		oceanic crust & $2885$ & $15$ & $oc$ \\
		\hline
		mantle & $3240$ & $370$ & $m$ \\
		\hline
	\end{tabular}
\end{center}
}


%%%%%%%%%%%%%%%%%% Tables %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%% Figures %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% Methodology

\plot{rifted-margin-model-color}{width=0.8\textwidth}{
	{Rifted margin model formed by four layers. Layer 1 
	represents a water with constant density $\rho^{(w)}$. Layer 2 is
	split into $Q$ sub-layers according to the complexity of the study area. 
	In this example, $Q = 2$.
	These sub-layers represent sediments, salt or volcanic rocks and have constant 
	densities $\rho^{(q)}$, $q = 1, \dots, Q$. 
	Layer 3 represents the crust. In this example, its density $\rho{(c)}$ assumes two possible 
	values $\rho^{(cc)}$ and $\rho^{(oc)}$ representing, respectively, continental and oceanic crust. 
	More complex models can be generated by using a function
	describing the lateral density variations within the crust.
	Finally, Layer 4 represents a homogeneous mantle with constant density
	$\rho^{(m)}$. Basement, Moho and reference Moho are represented by the dashed-white lines. 
	The reference mass distribution is formed by an upper layer with constant density $\rho^{(r)}$
	and base at the reference Moho. Below this layer, we presume a reference distribution with the
	same constant density $\rho^{(m)}$ of the mantle.}
	\label{fig:rifted-margin-model}
}

\plot{interpretation-model-color}{width=0.8\textwidth}{
	{Interpretation model formed by $N$ columns of vertically stacked prisms. 
	Each column is formed by four layers of prisms and locally approximates the 
	rifted margin model shown in Figure~\ref{fig:rifted-margin-model-color}.
	Each prism has a constant density contrast defined as the difference between
	its corresponding density at the rifted margin model 
	and the constant density $\rho^{(r)}$ of the shallowest layer forming
	the reference density distribution (Figure~\ref{fig:rifted-margin-model-color}).
	Basement, Moho and the reference Moho are represented by dashed-white lines. 
	The continuous black line represents the compensation depth
	at $S_{0}$. The reference Moho is located at $S_{0} + \Delta S$.}
	\label{fig:interpretation-model}
}

%% application to synthetic data

\plot{volcanic-margin-grafics-estimated-model-alphas_X_1_1_2}{width=0.6\textwidth}{
	{Application to synthetic data. Results obtained at Step 1. 
	(Bottom panel) Estimated and true surfaces,
	initial basement and Moho used in the inversion (initial guess) and a 
	priori information at some points on basement and Moho (known depths)
	(Middle panel) True and estimated lithostatic stress curves computed
	by using equation~\ref{eq:lithostatic-stress-densities}. The values are multiplied 
	by a constant gravity value equal to $9.81$ m/s$^{2}$.
	(Upper panel) Gravity disturbance data produced by the volcanic 
	margin model (simulated data), by the estimated model 
	(predicted data) and by the model used as initial guess in the 
	inversion (initial guess data).
	The contour of the prisms forming the interpretation model were omitted.
	We used $S_{0} = 41$ km and the density contrasts shown in Table~\ref{tab:volcanic-margin-model}.}
	\label{fig:volc-margem-step1}
}

\plot{volcanic-margin-grafics-estimated-model-alphas_2_1_1_2}{width=0.6\textwidth}{
	{Application to synthetic data. Results obtained at Step 2
	by using $\tilde{\alpha}_{0} = 10^{2}$ (equation~\ref{eq:constraint-weights}).
	The remaining informations are the same shown in the caption of
	Figure~\ref{fig:volc-margem-step1}.}
	\label{fig:volc-margem-step2}
}

\plot{volcanic-margin-grafics-estimated-model-alphas_2_1_1_2-sgm_22}{width=0.6\textwidth}{
	{Application to synthetic data. Results obtained at Step 3 by using 
	the estimated model shown in Figure~\ref{fig:volc-margem-step2} 
	as initial approximation (dashed blue lines) and
	$\sigma = 22$ (equation~\ref{eq:elements-wii}).
	The remaining informations are the same shown in the caption of
	Figure~\ref{fig:volc-margem-step1}.}
	\label{fig:volc-margem-step3-sgm22}
}

\plot{volcanic-margin-grafics-estimated-model-alphas_2_1_1_2-sgm_10}{width=0.6\textwidth}{
	{Application to synthetic data. Results obtained at Step 3 by using 
	the estimated model shown in Figure~\ref{fig:volc-margem-step2} 
	as initial approximation (dashed blue lines) and
	$\sigma = 10$ (equation~\ref{eq:elements-wii}).
	The remaining informations are the same shown in the caption of
	Figure~\ref{fig:volc-margem-step1}.}
	\label{fig:volc-margem-step3-sgm10}
}

\plot{volcanic-margin-grafics-estimated-model-alphas_2_1_1_2-sgm_40}{width=0.6\textwidth}{
	{Application to synthetic data. Results obtained at Step 3 by using 
	the estimated model shown in Figure~\ref{fig:volc-margem-step2} 
	as initial approximation (dashed blue lines) and
	$\sigma = 40$ (equation~\ref{eq:elements-wii}).
	The remaining informations are the same shown in the caption of
	Figure~\ref{fig:volc-margem-step1}.}
	\label{fig:volc-margem-step3-sgm40}
}

\plot{volcanic-margin-grafics-estimated-model-alphas_2_1_1_2-T2-dsed-SDR-sgm_8}{width=0.6\textwidth}{
	{Application to synthetic data. Results obtained at Step 3 by using 
	density values in Layer 2 (sediment + SDR) different from the true
	ones (Table~\ref{tab:volcanic-margin-model}).
	This estimated model was obtained by using $\sigma = 8$ (equation~\ref{eq:elements-wii}).
	The dashed blue lines (initial guess surfaces) represent the model
	obtained at Step 2.
	The remaining informations are the same shown in the caption of
	Figure~\ref{fig:volc-margem-step1}.}
	\label{fig:volc-margem-step3-alternative}
}

%% application to real data

\plot{map-line-localization}{width=0.8\textwidth}{
	{Application to real data on Pelotas basin, Brazil. Gravity disturbance
	providade by the global gravity field model EIGEN-6C4 \citep{forste2014} at
	the study area. The black straight line indicates the gravity profile over the Pelotas
	basin. The end points of the profile have coordinates (geodetic latitude and longitude) 
	$(-27.72, -48.23)$ and $(-29.66, -44.94)$. The coordinates are referred to the 
	WGS84 datum.}
	\label{fig:pelotas-location}
}

%\plot{pelotas-step3}{width=0.6\textwidth}{
%	{Application to real data on Pelotas basin, Brazil. Results obtained in Step 3 by
%	using $\sigma = 58$ (equation~\ref{eq:elements-wii}).
%	(Bottom panel) Estimated surfaces, initial basement and Moho used in the
%	inversion (initial guess) and a priori information at some points on 
%	basement and Moho (known depths).
%	The dashed white lines represent an alternative interpretation obtained 
%	by \citet{zalan2015} at the same study area.
%	(Middle panel) Estimated lithostatic stress curve computed
%	by using equation~\ref{eq:lithostatic-stress-densities}. The values are multiplied 
%	by a constant gravity value equal to $9.81$ m/s$^{2}$.
%	(Upper panel) Observed gravity disturbance data, data produced by the estimated
%	model (predicted data) and data produced the by model used as initial guess in the
%	inversion (initial guess data).
%	The contour of the prisms forming the interpretation model were omitted.
%	The density contrasts were defined according to Table~\ref{tab:volcanic-margin-model}.
%	\label{fig:pelotas-step3}}
%}
%
%\plot{pelotas-step3-more-inf}{width=0.6\textwidth}{
%	{Application to real data on Pelotas basin, Brazil. Results obtained in Step 3 by
%	using $\sigma = 58$ (equation~\ref{eq:elements-wii}) and additional
%	a priori information at basement. The remaining informations are the same shown in
%	the caption of Figure \ref{fig:pelotas-step3}.
%	\label{fig:pelotas-step3-more-infs}}
%}


%%%%%%%%%%%%%%%%%% Figures %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{ACKNOWLEDGMENTS}

%\lipsum[1]


\newpage

\bibliographystyle{seg.bst}  % style file is seg.bst
\bibliography{bib-file.bib}


\end{document}


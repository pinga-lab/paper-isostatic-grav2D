%\documentclass[paper,twocolumn,twoside]{geophysics}
%\documentclass[manuscript,revised]{geophysics}
\documentclass[manuscript]{geophysics}

% An example of defining macros
\newcommand{\rs}[1]{\mathstrut\mbox{\scriptsize\rm #1}}
\newcommand{\rr}[1]{\mbox{\rm #1}}

% Extra packages
\usepackage{amsmath}
\usepackage{bm}
\usepackage[pdftex,colorlinks=true]{hyperref}
\hypersetup{
	allcolors=black,
}
\usepackage{lipsum}
\usepackage[table]{xcolor}

\renewcommand{\figdir}{figures} % figure directory

\begin{document}

\title{Isostatic constraint for 2D gravity inversion on passive rifted margins}

\renewcommand{\thefootnote}{\fnsymbol{footnote}} 

\ms{GEO-XXXX} % manuscript number

\address{
\footnotemark[1]Observat\'{o}rio Nacional, \\
Department of Geophysics, \\
Rio de Janeiro, Brazil}
\author{B. Marcela S. Bastos\footnotemark[1] and Vanderlei C. Oliveira Jr\footnotemark[1]}

\footer{vanderlei@on.br}
\lefthead{Bastos and Oliveira Jr.}
\righthead{Isostatic constraint for gravity inversion on passive margins}

\maketitle

\begin{abstract}

\lipsum[1]

\end{abstract}

\section{Introduction}

Several methods have been proposed for using gravity and/or magnetic data to estimate
the boundaries of juxtaposed sedimentary layers, the relief of basement under sedimentary 
basins and/or the Mohorovicic discontinuity (or simply Moho), which separates crust and 
mantle.
These geophysical discontinuities represent, for such particular methods, 
density and/or magnetization contrasts in subsurface.
All these methods suffer from the inherent ambiguity \citep{roy1962, skeels1962} in
determining the true physical property distribution that produces a discrete set of
observed potential-field data. 
It is well known that, by using different density and/or magnetization contrasts, 
it is possible to
find different surfaces producing the same potential-field data. 
To partially overcome this problem and obtain meaningful solutions, the interpreter
must commonly use priori information obtained from seismic data and/or boreholes in
order to constrain the range of possible models.

There are methods that approximate the subsurface by a grid of
juxtaposed cells with constant physical property. 
They estimate the physical property value of each cell and then 
interpret the estimated values to indirectly estimate the geometry of the 
geophysical discontinuities.
Although very useful in geophysics, such methods are
outside the scope of the present work.
Here, we consider methods that represent discontinuities by surfaces 
separating layers with constant or depth-dependent physical property distribution 
(density and/or magnetization).
In this case, the geometry of the geophysical discontinuities are directly determined
by estimating the geometrical parameters describing the surfaces.

Different criteria can be used to classify the methods that directly estimate
the geometry of geophysical discontinuities.
Those applied over a sedimentary basin, for example, can be considered local scale methods,
whereas those applied over a continent or country can be considered regional scale methods
and those applied over the whole globe can be considered global scale methods.
They can also be classified according to the number of geophysical surfaces
to be estimated.

By using these criteria, it is possible to define a first group of methods
estimating the geometry of a single interface.
In this group, there are local scale methods in space domain
% scale: local | data: gravity | domain: space
\citep[e.g.,][]{bott1960, tanner1967, cordell-henderson1968, dyrelius-vogel1972, pedersen1977,
pilkington-crossley1986, richardson-macinnes1989, barbosa-etal1997, 
barbosa-etal1999, barbosa-etal1999b, silva-etal2006, pilkington2006, 
chakravarthi-sundararajan2007, martins-etal2010, silva-etal2010, lima-etal2011, 
martins-etal2011, barnes-barraud2012, silva-etal2014, silva-santos2017},
and Fourier domain
% scale: local | data: gravity | domain: Fourier
\citep[e.g.,][]{oldenburg1974, granser1987, reamer-ferguson1989, guspi1993}.
Most of these methods were applied to estimate the relief of basement under
a sedimentary basin.
There are also regional scale methods for estimating a single interface 
representing the Moho in spaced domain 
% scale: regional | data: gravity | domain: space
\citep[e.g.,][]{shin-etal2009, bagherbandi-eshagh2012, barzaghi-biagi2014, sampietro2015, uieda-barbosa2017} and in Fourier domain 
% scale: regional | data: gravity | domain: Fourier
\citep[e.g.,][]{braitenberg-etal1997, braitenberg-zadro1999, vandermeijde-etal2013}.
Additionally, there are some global scale methods for estimating the Moho
in spaced domain
% scale: global | data: gravity | domain: space
\citep[e.g.,][]{sunkel1985, sjoberg2009}.

The second group of methods is formed by those estimating multiple surfaces
separating layers with constant or depth-dependent physical properties 
\citep[e.g.,][]{pilkington-crossley1986b, gallardo-etal2005, camacho-etal2011, 
salem-etal2014}.
All these methods have been applied at local scale, to characterize a single 
sedimentary basin.
The number of methods forming this group is significantly lower than that
in the first one.
Additionally, the methods forming the second group suffer from a greater 
ambiguity and, as a consequence, they require more priori information to
decrease the number of possible solutions.

Among those directly estimating the geometry of the surfaces, 
there are some regional and global scale methods in space domain that impose 
some degree of isostatic equilibrium to the estimated models 
\citep[e.g.,][]{sunkel1985, sjoberg2009, bagherbandi-eshagh2012, sampietro2015}
or analyze their deviations from a perfect isostatic equilibrium
\citep[e.g.,][]{shin-etal2009}.
\citet{salem-etal2014} presented one of the few local scale 
methods in space domain that simultaneously estimates the basement and Moho
reliefs by imposing isostatic equilibrium. 
They imposed a perfect isostatic equilibrium according to
the Airy's local compensation model \citep{turcotte-schubert2002}, 
which describes well the transition
from continental to oceanic crust at rifted margins 
\citep{worzel1968, watts-moore2017}.

Here, we present a new local scale method for simultaneously estimating the geometries
of basement and Moho along a profile on a passive rifted margin.
Our method is formulated, in space domain, as a non-linear gravity inversion.
In order to produce stable solutions and introduce priori information,
we use different constraints imposing smoothness and lower/upper 
bounds on basement and Moho depths, as well as proximity between estimated 
and known depths at some points along the profile. We also use a constraint
(which we conveniently call as \textit{isostatic constraint}) imposing smoothness
on the lithostatic stress exerted on a planar surface located at depth,
below which we assume that there is no lateral density variations.
We considered that no vertical forces are acting on the lateral surfaces of 
each column forming the lithosphere.
Notice that, by imposing smoothness on the lithostatic stress,
our method does not estimate a model in perfect isostatic equilibrium, 
but a model as close as possible to the isostatic equilibrium.
Tests with synthetic data show the performance of our method in simultaneously
retrieving the geometry of basement and Moho of different models. 
We also analyze the influence of the isostatic constraint on the estimated
surfaces at regions showing abrupt crustal thinning, which is
typically shown in volcanic passive margins \citep{geoffroy2005}.
Finally, we illustrate the performance of our method by inverting 
satellite gravity data on a profile over the Pelotas basin \citep{stica-etal2014}, 
which is located at the southern of Brazil and is considered a classical example 
of volcanic passive margin.


\section{Methodology}


\subsection{Forward problem}


Let $\mathbf{d}^{o}$ be the observed data vector, whose $i$-th element $d^{o}_{i}$, 
$i = 1, \dots, N$, represent the observed gravity disturbance at the point 
$(x_{i}, y_{i}, z_{i})$, on a profile located over a rifted passive margin. The
coordinates are referred to a topocentric Cartesian system, with $z$ axis pointing
downward, $y$-axis along the profile and $x$-axis perpendicular to the profile. 
We assume that the actual mass distribution in a rifted passive margin can be 
schematically represented according to Figure~\ref{fig:rifted-margin-model}. 
In this model, the subsurface is formed by four layers. 
The first and shallowest one represents a water layer with constant density
$\rho^{(w)}$. 
The second layer is formed by $Q$ vertically adjacent parts representing sediments,
salt or volcanic rocks.
In our example, this layer is formed by two parts with constant densities
$\rho^{(q)}$, $q = 1, 2$. Different models can be created by changing the number $Q$.
The third layer of our model represents the crust. For simplicity, we presume that the
crust density may be equal to $\rho^{(cc)}$, which
represents the continental crust, or equal to $\rho^{(oc)}$, which represents the
oceanic crust.
The deepest layer represents a homogeneous mantle with constant density $\rho^{(m)}$. 
The interface separating the second and third layers defines the basement relief whereas
that separating the third and fourth layers defines the Moho. These surfaces are
represented by dashed-white lines in Figure~\ref{fig:rifted-margin-model}.
We also presume the existence of an isostatic compensation depth at $S_{0}$ 
(represented as a continuous white line in Figure~\ref{fig:rifted-margin-model}),
below which there is no lateral variations in the mass distribution.

In order to define the anomalous mass distribution producing the observed gravity
disturbance, we presume a reference mass distribution formed by two 
layers (not shown). The shallowest layer represents a homogeneous crust with constant
density $\rho^{(r)}$.
The deepest layer in the reference mass distribution represents a homogeneous mantle
with constant density $\rho^{(m)}$. Notice that the mantle in the reference mass 
distribution has the same density as the mantle in our rifted margin model
(Figure~\ref{fig:rifted-margin-model}).
The interface separating the crust and mantle in the reference mass distribution 
is conveniently called \textit{reference Moho} (represented as a continuous white line
in Figure~\ref{fig:rifted-margin-model}).
The reference model can be thought of as the outer layers of a concentric
mass distribution producing the normal gravity field.

We consider that the anomalous mass distribution producing the observed data
is defined as the difference between the rifted margin model 
(Figure~\ref{fig:rifted-margin-model}) and the reference mass distribution (not shown).
As a consequence, the anomalous mass distribution is characterized by regions
with constant density contrast.
This anomalous distribution is approximated by an interpretation model 
formed by $N$ columns of vertically stacked prisms 
(Figure~\ref{fig:interpretation-model}).
For convenience, we presume that there is an observed gravity disturbance over the
center of each column.
We consider that the prisms in the extremities of the interpretation model extend to
infinity along the $y$ axis in order to prevent edge effects in the forward 
calculations. 
The $i$-th column is formed by four vertically adjacent layers, which in turn are
composed of vertically adjacent prisms having infinite length along the $x$-axis.

The first and shallowest layer represents water, 
is formed by a single prism, has thickness $t^{(w)}_{i}$ and a constant density
contrast $\Delta \rho^{(w)} = \rho^{(w)} - \rho^{(r)}$.
The second layer forming the $i$-th column of the interpretation model is defined by
the interpreter, according to the geological environment to be studied and the a priori
information availability. 
As a general rule, this layer can be defined by a set of $Q$ vertically adjacent
prisms, each one with thickness $t^{(q)}_{i}$ and constant density contrast
$\Delta \rho^{(q)} = \rho^{(q)} - \rho^{(r)}$, $q = 1, \dots Q$.
The third layer represents the crust, it is also formed by a single prism,
has thickness $t^{(c)}_{i}$ and density contrast 
$\Delta \rho^{(c)}_{i} = \rho^{(c)} - \rho^{(r)}$, 
with $\rho^{c}$ being the crust density. 
According to our rifted margin model (Figure~\ref{fig:rifted-margin-model}), the crust
density $\rho^{(c)}_{i}$ may assume two possible values, depending on its position
with respect to the $y_{COT}$ (Figure~\ref{fig:interpretation-model}).
As a consequence, the prisms forming the third layer of the interpretation model may
have two possible density contrasts: $\Delta \rho^{(c)}_{i} = \rho^{(cc)} - \rho^{(r)}$,
for $y_{i} \le y_{COT}$, or $\Delta \rho^{(c)}_{i} = \rho^{(oc)} - \rho^{(r)}$,
for $y_{i} > y_{COT}$. 
The top of this layer defines the basement relief and its bottom the relief of the
Moho. 
The fourth layer represents the mantle, it is divided into two parts, each one formed
by a single prism having a constant density contrast 
$\Delta \rho^{(m)} = \rho^{(m)} - \rho^{(r)}$. The shallowest
portion of this layer has thickness $t^{(m)}_{i}$. Its top and bottom define,
respectively, the depths of Moho and the planar isostatic compensation layer $S_{0}$.
The deepest portion of the fourth layer has thickness $\Delta S_{0}$, top at the
surface $S_{0}$ and bottom at the planar surface 
$S_{0} + \Delta S_{0}$, which defines the reference Moho. 


Given the density contrasts, the COT position $y_{COT}$, the isostatic compensation
depth $S_{0}$, the thickness of the water layer and of the $Q-1$ prisms forming the
shallowest portion of the second layer, it is possible to describe the interpretation
model in terms of an $M \times 1$ parameter vector $\mathbf{p}$, $M = 2N + 1$, defined
as follows:
\begin{equation}
\mathbf{p} = \begin{bmatrix}
\mathbf{t}^{Q} \\
\mathbf{t}^{m} \\
\Delta S_{0}
\end{bmatrix} \: ,
\label{eq:parameter-vector}
\end{equation}
where $\mathbf{t}^{Q}$ and $\mathbf{t}^{m}$ are $N \times 1$ vectors whose $i$-th
elements $t^{Q}_{i}$ and $t^{m}_{i}$ represent, respectively, the thickness of the
prism forming the deepest portion of the second layer and the thickness of the prism
forming the shallowest portion of the fourth layer of the interpretation model.
In this case, the gravity disturbance produced by the interpretation model (the
predicted gravity disturbance) at the position $(x_{i}, y_{i}, z_{i})$ can be written
as the sum of the vertical component of the gravitational attraction exerted by the $L$
prisms forming the interpretation model as follows:
\begin{equation}
d_{i}(\mathbf{p}) = k_{g} \, G \, \sum_{j = 1}^{L} f_{ij}(\mathbf{p}) \: ,
\label{eq:ith-predicted-data}
\end{equation}
where $f_{ij}(\mathbf{p})$ represents an integral over the volume of the $j$-th 
prism. Here, these volume integrals are computed with the expressions proposed 
by \citet{nagy-etal2000}, by using the open-source Python package 
\textit{Fatiando a Terra} \citep{uieda-etal2013}.


\subsection{Inverse problem}


Let $\mathbf{d}(\mathbf{p})$ be the predicted data vector, whose $i$-th element
$d_{i}(\mathbf{p})$ is defined by Equation~\ref{eq:ith-predicted-data}. Estimating the
particular parameter vector $\mathbf{p} = \hat{\mathbf{p}}$ producing a predicted data
vector $\mathbf{d}(\mathbf{p})$ as close as possible to the observed data vector 
$\mathbf{d}^{o}$ can be formulated as the problem of minimizing the goal function
\begin{equation}
\Gamma (\mathbf{p}) = \Phi(\mathbf{p}) + \mu \sum_{\ell = 0}^{3} \alpha_{\ell}
\Psi_{\ell}(\mathbf{p}) \: ,
\label{eq:goal-function}
\end{equation}
subject to 
\begin{equation}
p_{j}^{min} < p_{j} < p_{j}^{max} \: , \quad j = 1, \dots, M \: ,
\label{eq:inequality-constraint}
\end{equation}
where $p_{j}^{min}$ and $p_{j}^{max}$ define, respectively, lower and upper bounds 
for the $j$-th element of $\mathbf{p}$.
The goal function is minimized by using the Levenberg-Marquardt method \citep{aster-etal2005}
and the inequality constraint (equation \ref{eq:inequality-constraint}) is
incorporated by using the same strategy employed by \citet{barbosa-etal1999}.
In Equation~\ref{eq:goal-function}, $\mu$ represents the regularizing parameter, 
$\Phi(\mathbf{p})$ represents the misfit function given by
\begin{equation}
\Phi(\mathbf{p}) = \frac{1}{N} \| \mathbf{d}^{o} - \mathbf{d}(\mathbf{p}) \|_{2}^{2} 
\: , 
\label{eq:misfit-function}
\end{equation}
where $\| \cdot \|_{2}^{2}$ represents the squared Euclidean norm, $\alpha_{\ell}$
represent the weights assigned to the regularizing functions $\Psi_{\ell}(\mathbf{p})$,
which define the constraints on the parameters to be estimated, $\ell = 0, 1, 2, 3$.
All the derivatives of the misfit function $\Phi(\mathbf{p})$ with respect to the parameters 
as computed by using a central finite difference approximation. Finally,
the weights $\alpha_{\ell}$ (equation~\ref{eq:goal-function}) are defined 
as follows:
\begin{equation}
\alpha_{\ell} = \tilde{\alpha}_{\ell} \, f_{\ell} \: , \quad \ell = 0, 1, 2, 3 \: ,
\label{eq:constraint-weights}
\end{equation}
where $\tilde{\alpha}_{\ell}$ is a positive scalar, $f_{\ell} = \frac{E_{\Phi}}{E_{\ell}}$, 
$E_{\ell}$ is the median of the elements forming the main diagonal of the Hessian matrix of the 
$\ell$-th constraining function $\Psi_{\ell}(\mathbf{p})$ 
(equations~\ref{eq:isostatic-constraint-function}, \ref{eq:smootheness-contraint},
\ref{eq:equality-constraint-basement} and \ref{eq:equality-constraint-moho})
and $E_{\Phi}$ is the median of the
elements forming the main diagonal of the Hessian matrix of the misfit function 
$\Phi(\mathbf{p})$ (equation~\ref{eq:misfit-function}) produced by the initial
approximation for $\mathbf{p}$.
Notice that, in fact, the interpreter defines the
weights $\alpha_{\ell}$ indirectly from the previously assigned values for the 
positive scalars $\tilde{\alpha}_{\ell}$ (equation \ref{eq:constraint-weights}).


\subsection{Isostatic constraint}

Consider that the interpretation model (Figure~\ref{fig:interpretation-model})
is in isostatic equilibrium \citep{turcotte-schubert2002, hofmann-wellenhof-moritz2005,
lowrie2007} so that the lithostatic stress (pressure) is constant on the
isostatic compensation surface $S_{0}$.
The ratio of the lithostatic stress to gravity exerted by the $i$-th 
column of the model on $S_{0}$ is given by:
\begin{equation}
t^{(w)}_{i} \rho^{(w)} + t^{(1)}_{i} \rho^{(1)}_{i} + \dots + 
t^{(Q)}_{i} \rho^{(Q)}_{i} + t^{(c)}_{i} \rho^{(c)}_{i} + t^{(m)}_{i} \rho^{(m)} 
= \sigma_{0} \: ,
\label{eq:lithostatic-stress-densities}
\end{equation}
where $\sigma_{0}$ is an arbitrary positive constant. 
Here, we considered that no vertical forces are acting on the lateral surfaces of 
each column forming the model.
By rearranging terms in Equation~\ref{eq:lithostatic-stress-densities} 
and using the relation
\begin{equation}
S_{0} = t^{(w)}_{i} + t^{(1)}_{i} + \dots + t^{(Q)}_{i} + t^{(c)}_{i} + t^{(m)}_{i} \: ,
\label{eq:S0}
\end{equation}
it is possible to show that:
\begin{equation}
\Delta \tilde{\rho}^{(Q)}_{i} \, t^{(Q)}_{i} + 
\Delta \tilde{\rho}^{(m)}_{i} \, t^{(m)}_{i} + 
\Delta \tilde{\rho}^{(w)}_{i} \, t^{(w)}_{i} + 
\Delta \tilde{\rho}^{(1)}_{i} \, t^{(1)}_{i} +
\dots + 
\Delta \tilde{\rho}^{(Q-1)}_{i} \, t^{(Q-1)}_{i} +
\rho^{(c)}_{i} \, S_{0} = \sigma_{0} \: ,
\label{eq:lithostatic-stress-density-contrasts}
\end{equation}
where $\Delta \tilde{\rho}^{(\alpha)}_{i} = \rho^{(\alpha)}_{i} - \rho^{(c)}_{i}$, 
$\alpha = w, 1, \dots, Q-1, Q, m$.
In order to describe the lithostatic stress exerted by all columns forming the
interpretation model on the surface $S_{0}$, 
Equation~\ref{eq:lithostatic-stress-density-contrasts} 
can be written, in matrix notation, as follows:
\begin{equation}
\mathbf{M}^{(Q)} \mathbf{t}^{(Q)} + \mathbf{M}^{(m)} \mathbf{t}^{(m)} + \mathbf{M}^{(w)}
\mathbf{t}^{(w)} + \mathbf{M}^{(1)} \mathbf{t}^{(1)} + \dots + \mathbf{M}^{(Q-1)}
\mathbf{t}^{(Q-1)} + \boldsymbol{\rho}^{(c)} S_{0} = \sigma_{0} \mathbf{1} \: ,
\label{eq:lithostatic-stress-matrix}
\end{equation}
where $\mathbf{1}$ is an $N \times 1$ vector with all elements equal to one, 
$\mathbf{t}^{(\alpha)}$, $\alpha = w, 1, \dots, Q-1, Q, m$, are $N \times 1$ vectors
with $i$-th element defined by the thickness $t^{(\alpha)}_{i}$ of a prism forming the
$i$-th column, $\mathbf{M}^{(\alpha)}$ are $N \times N$ diagonal matrices with elements
$ii$ of main diagonal defined by the density contrasts 
$\Delta \tilde{\rho}^{(\alpha)}_{i}$, respectively, and $\boldsymbol{\rho}^{(c)}$ is an 
$N \times 1$ vector containing the densities of the prisms
representing the crust. By applying the first-order Tikhonov regularization
\citep{aster-etal2005} to the constant vector $\sigma_{0} \mathbf{1}$, we obtain the
following expression:
\begin{equation}
\mathbf{R} \left( \mathbf{C} \mathbf{p} + \mathbf{D} \mathbf{t} \right) = \mathbf{0} 
\: ,
\label{eq:tik1-lithostatic-stress}
\end{equation}
where $\mathbf{0}$ is a vector with null elements and the remaining terms are given by:
\begin{equation}
\mathbf{C} = \begin{bmatrix}
\mathbf{M}^{(Q)} & \mathbf{M}^{(m)} & \mathbf{0}
\end{bmatrix}_{N \times M} \: ,
\label{eq:matrix-C}
\end{equation}
\begin{equation}
\mathbf{D} = \begin{bmatrix}
\mathbf{M}^{(w)} & \mathbf{M}^{(1)} & \cdots & \mathbf{M}^{(Q-1)} &
\boldsymbol{\rho}^{(c)}
\end{bmatrix}_{N \times \left( QN + 1 \right)} \: ,
\label{eq:matrix-D}
\end{equation}
\begin{equation}
\mathbf{t} = \begin{bmatrix}
\mathbf{t}^{(w)} \\ \mathbf{t}^{(1)} \\ \vdots \\ \mathbf{t}^{(Q-1)} \\ S_{0}
\end{bmatrix}_{\left( QN + 1 \right) \times 1}\: ,
\label{eq:vector-t}
\end{equation}
$\mathbf{p}$ is the parameter vector (Equation~\ref{eq:parameter-vector}) and
$\mathbf{R}$ is an $\left( N-1 \right) \times N$ matrix, whose element $ij$ is defined
as follows:
\begin{equation}
\left[ \mathbf{R} \right]_{ij} = \begin{cases}
1 &, \quad j = i \\
-1 &, \quad j = i + 1 \\
0 &, \quad \text{otherwise}
\end{cases} \quad .
\label{eq:matrix-R}
\end{equation}
Finally, from Equation~\ref{eq:tik1-lithostatic-stress}, it is possible to
define the regularizing function $\Psi_{0}(\mathbf{p})$ 
(Equation~\ref{eq:goal-function}): 
\begin{equation}
\Psi_{0}(\mathbf{p}) = \| \mathbf{R} \left( \mathbf{C} \mathbf{p} + \mathbf{D}
\mathbf{t} \right) \|_{2}^{2} \: .
\label{eq:isostatic-constraint-function}
\end{equation}
We conveniently call this function as \textit{Isostatic constraint}. 
Notice that minimizing this function imposes smoothness on the pressure exerted by the interpretation model on the isostatic compensation surface $S_{0}$. Consequently,
it imposes an interpretation model as close as possible of an isostatic
equilibrium.


\subsection{Smoothness constraint}


This constraint imposes smoothness on the adjacent thickness of the prisms forming the
deepest portion of the second layer and the shallowest part of the fourth layer
of the interpretation model by applying the first-order Tikhonov regularization
\citep{aster-etal2005} to the vectors $\mathbf{t}^{(Q)}$ and $\mathbf{t}^{(m)}$ 
(Equation~\ref{eq:parameter-vector}). 
Mathematically, this constraint is represented by the regularizing function
$\Psi_{1}(\mathbf{p})$ (Equation~\ref{eq:goal-function}):
\begin{equation}
\Psi_{1}(\mathbf{p}) = \| \mathbf{S}\mathbf{p} \|_{2}^{2} \: ,
\label{eq:smootheness-contraint}
\end{equation}
where $\mathbf{S}$ is an $\left( N-1 \right) \times M$ matrix given by:
\begin{equation}
\mathbf{S} = \begin{bmatrix}
\mathbf{R} & \mathbf{R} & \mathbf{0}
\end{bmatrix} \: ,
\label{eq:matrix-S}
\end{equation}
where $\mathbf{R}$ is defined by Equation~\ref{eq:matrix-R} and $\mathbf{0}$
is a vector with all elements equal to zero.


\subsection{Equality constraint}

\subsubsection*{Equality constraint on basement depths}

Let $\mathbf{a}$ be a vector whose $k$-th element $a_{k}$,
$k = 1, \dots, A$, is the known basement depth at the horizontal coordinate
$y^{A}_{k}$ of the profile. These known basement depth values are used to define 
the regularizing function $\Psi_{2}(\mathbf{p})$ 
(Equation~\ref{eq:goal-function}):
\begin{equation}
\Psi_{2}(\mathbf{p}) = \| \mathbf{A}\mathbf{p} - \mathbf{a} \|_{2}^{2} \: ,
\label{eq:equality-constraint-basement}
\end{equation}
where $\mathbf{A}$ is an $A \times M$ matrix whose $k$-th line has one element 
equal to one and all the remaining elements equal to zero. The location of the
single non-null element in the $k$-th line of $\mathbf{A}$ depends on the coordinate
$y^{A}_{k}$ of the known basement depth $a_{k}$. Let us consider, 
for example, an interpretation model formed by $N = 10$ columns. Consider also that 
the basement depth at the coordinates $y^{A}_{1} = y_{4}$ and $y^{A}_{2} = y_{9}$ of
the profile are equal to $25$ and $35.7$ km, respectively. In this case, $A = 2$,
$\mathbf{a}$ is a $2 \times 1$ vector with elements $a_{1} = 25$ and $a_{2} = 35.7$
and $\mathbf{A}$ is a $2 \times M$ matrix ($M = 2N + 1 = 21$). The element $4$ of the
first line and the element $9$ of the second line of $\mathbf{A}$ are equal to $1$ and
all its remaining elements are equal to zero.

\subsubsection*{Equality constraint on Moho depths}

Let $\mathbf{b}$ be a vector whose $k$-th element $b_{k}$,
$k = 1, \dots, B$, is the difference between the isostatic compensation depth
$S_{0}$ and the known Moho depth at the horizontal coordinate $y^{B}_{k}$ of the
profile. These differences, which must be positive, are used to define the 
regularizing function $\Psi_{3}(\mathbf{p})$ (Equation~\ref{eq:goal-function}):
\begin{equation}
\Psi_{3}(\mathbf{p}) = \| \mathbf{B}\mathbf{p} - \mathbf{b} \|_{2}^{2} \: ,
\label{eq:equality-constraint-moho}
\end{equation}
where $\mathbf{B}$ is a $B \times M$ matrix whose $k$-th line has one element 
equal to one and all the remaining elements equal to zero. This matrix is defined 
in the same way as matrix $\mathbf{A}$ (Equation~\ref{eq:equality-constraint-basement}).


\subsection{Practical procedures}


Describe a brief recipe for choosing the weights $\tilde{\alpha}_{\ell}$ 
(equation~\ref{eq:constraint-weights}) based on the convergence of the
inverse problem, estimated model, etc.



\section{Applications to synthetic data}


\subsection{Simple models}

We have simulated two simple models (I and II) formed by four layers: water, sediments,
crust (continental and oceanic) and mantle.
%(Table~\ref{tbl:simple-models}).
The only differences between them are the geometries of basement and Moho.
Figure~\ref{fig:simple-model-I-without-isostatic-constraint} 
shows the result obtained by applying 
our method to invert the synthetic gravity disturbance produced by the simple model I,
as well as the initial guess and known depths used in the inversion.
This result was obtained by using all but the isostatic constraint.
The weights $\alpha_{\ell}$ (equation~\ref{eq:goal-function}) were defined
by using $\tilde{\alpha}_{\ell}$ (equation~\ref{eq:constraint-weights}) given by: 
$\tilde{\alpha}_{0} = 0$, $\tilde{\alpha}_{1} = 10^{1}$, 
$\tilde{\alpha}_{2} = 10^{2}$ and $\tilde{\alpha}_{3} = 10^{2}$.
Notice that, without using the isostatic constraint, our method was able
to estimate a model that fits the simulated gravity disturbance and 
lithostatic stress curve, as well as shows basement and Moho reliefs 
very close to the true ones.
In this case, both basement and Moho are smooth. However,
the lithostatic stress curve shows a pronounced discontinuity over the COT. 
This feature breaks the smoothness of the lithostatic stress curve and 
is not compatible with the a priori information imposed by
the isostatic constraint (equation~\ref{eq:isostatic-constraint-function}).

Figure~\ref{fig:simple-model-I-all-constraints} shows the result
obtained by using all the constraints (including the isostatic constraint).
In this case, the weights $\alpha_{\ell}$ (equation~\ref{eq:goal-function}) 
were defined by using different values for the positive scalars 
$\tilde{\alpha}_{\ell}$ (equation~\ref{eq:constraint-weights}): 
$\tilde{\alpha}_{0} = 10^{2}$, $\tilde{\alpha}_{1} = 10^{1}$, 
$\tilde{\alpha}_{2} = 10^{2}$ and $\tilde{\alpha}_{3} = 10^{2}$.
By using the isostatic constraint, we obtain a predicted 
lithostatic stress curve that is smoother than that shown in 
Figure~\ref{fig:simple-model-I-without-isostatic-constraint}. 
However, differently from the previous result, there is a significant 
discrepancy between the estimated and true reliefs of basement and Moho.
The larger differences occur on the region close to COT, where the 
true lithostatic stress curve shows that steep slope.
These results illustrate a situation in which the a priori information
imposed by the isostatic constraint is not compatible with the 
true model.

Figures~\ref{fig:simple-model-II-without-isostatic-constraint} and 
\ref{fig:simple-model-II-all-constraints}
show an example in which the isostatic constraint imposes the correct
a priori information. 
These results were obtained by applying our method to invert the synthetic gravity 
disturbance produced by the simple model II.
The result shown in the first figure was obtained by using all but 
the isostatic constraint. The weights $\alpha_{\ell}$ 
(equation~\ref{eq:goal-function}) were defined by
using $\tilde{\alpha}_{\ell}$ (equation~\ref{eq:constraint-weights}) given by: 
$\tilde{\alpha}_{0} = 0$, $\tilde{\alpha}_{1} = 10^{-1}$, 
$\tilde{\alpha}_{2} = 10^{0}$ and $\tilde{\alpha}_{3} = 10^{0}$.
The result shown in Figure~\ref{fig:simple-model-II-all-constraints} was
obtained by using all constraints. 
The weights $\alpha_{\ell}$ (equation~\ref{eq:goal-function}) were defined by
using $\tilde{\alpha}_{\ell}$ (equation~\ref{eq:constraint-weights}) given by: 
$\tilde{\alpha}_{0} = 10^{0}$, $\tilde{\alpha}_{1} = 10^{-1}$, 
$\tilde{\alpha}_{2} = 10^{0}$ and $\tilde{\alpha}_{3} = 10^{0}$.
In this example, the results obtained with and without the isostatic 
constraint produced practically the same data fit. However, there are 
significant differences on the lithostatic stress curves and the geometry of 
the estimated models. 
We can see that the isostatic constraint produces a smoother  
lithostatic stress curve, which is in perfect agreement with the a priori information
imposed by the regularizing function $\Psi_{0}(\mathbf{p})$
(equation~\ref{eq:isostatic-constraint-function}).
The isostatic constraint also produces an estimated Moho which is closer to the
true one along the entire profile.
The main differences in the estimated basement, however, occur at the 
first $\approx 60$ km, on the region coincident with the abrupt crustal thinning
in the simple model II.
It is worth noting that, on this region, the true lithostatic stress curve is
relatively smooth and the basement presents steep slopes.
These slopes cannot be properly retrieved without using the isostatic
constraint, as shown in Figure~\ref{fig:simple-model-II-without-isostatic-constraint}.
Differently from the results shown in 
Figure~\ref{fig:simple-model-I-without-isostatic-constraint} and
\ref{fig:simple-model-I-all-constraints},
those shown in
Figures~\ref{fig:simple-model-II-without-isostatic-constraint} and 
\ref{fig:simple-model-II-all-constraints}
exemplify a case in which the isostatic constraint contributes to
better estimating the geometries of basement and Moho.


\subsection*{Volcanic margin model}

We have simulated a simple volcanic margin model formed by four layers: 
water, sediments + seaward dipping reflectors, crust (continental and oceanic) 
and mantle.
Similarly to the simple model II (Figures~\ref{fig:simple-model-II-without-isostatic-constraint}
and \ref{fig:simple-model-II-all-constraints}), our volcanic margin model
shows a significant crustal thinning at the first part of
the profile.
Figures~\ref{fig:volcanin-margin-without-isostatic-constraint} and 
\ref{fig:volcanin-margin-all-constraints} show the results obtained,
respectively, by using and not using the isostatic constraint to estimate
the geometries of basement and Moho.
The weights $\alpha_{\ell}$ (equation~\ref{eq:goal-function}) used
to obtain the result shown in the first figure were defined with
$\tilde{\alpha}_{\ell}$ (equation~\ref{eq:constraint-weights}) equal to: 
$\tilde{\alpha}_{0} = 0$, $\tilde{\alpha}_{1} = 10^{-1}$, 
$\tilde{\alpha}_{2} = 10^{0}$ and $\tilde{\alpha}_{3} = 10^{0}$.
The $\tilde{\alpha}_{\ell}$ (equation~\ref{eq:constraint-weights}) used to
obtain the result shown in Figure~\ref{fig:volcanin-margin-all-constraints} 
are given by: $\tilde{\alpha}_{0} = 10^{0}$, $\tilde{\alpha}_{1} = 10^{-1}$, 
$\tilde{\alpha}_{2} = 10^{0}$ and $\tilde{\alpha}_{3} = 10^{0}$.

We can see that, without using the isostatic constraint, out method could not 
retrieve the pronounced crustal thinning located at the first part of our
volcanic margin model. As shown in 
Figure~\ref{fig:volcanin-margin-without-isostatic-constraint},
the difference between the estimated and true basement reach
$\approx 10$ km at the position $\approx 75$ km on the profile.
On the other hand, as in the previous test with the simple model II, 
the isostatic constraint was able to produce an estimated basement
very close to the true one (Figure~\ref{fig:volcanin-margin-all-constraints}).


\section{Application to real data}

We applied our method to interpret a gravity profile over the Pelotas basin
\citep{stica-etal2014}, located at the southern of Brazil. This basin is considered
a classical example of volcanic margin \citep{geoffroy2005} showing ...


\section{Conclusions}

\lipsum[1-3]

%%%%%%%%%%%%%%%%%% Tables %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\tabl{simple-models}{Properties of the simple models I and II. 
%	The density contrasts are defined with respect to the reference value 
%	$\rho^{(r)} = 2670$ kg/m$^{3}$. The model extends from $y = 0$ km
%	to $y = 195$ km. The Crust-Ocean Transition (COT) is located at $y_{COT} = 117$ km.
%}{
%\begin{center}
%	\begin{tabular}{lcc}
%		\hline
%		\textbf{Geological meaning} & \textbf{Density} $\rho$ (kg/m$^{3}$) & \textbf{Horizontal extension}\\
%		\hline
%		water & 1030 & the whole model \\
%		\hline
%		sediments & 2550 & the whole model \\
%		\hline 
%		continental crust & 2670 & from $y = 0$ km until $y_{COT}$ \\
%		oceanic crust & 2840 & from $y_{COT}$ until $y = 195$ km \\
%		\hline
%		mantle & 3200 & the whole model \\
%		\hline
%	\end{tabular}
%\end{center}
%}
%
%\tabl{volcanic-margin-model}{Properties of the volcanic magin model. 
%	The density contrasts are defined with respect to the
%	reference value $\rho^{(r)} = 2770$ kg/m$^{3}$. The model extends from $y = 0$ km
%	to $y = 383$ km. The Crust-Ocean Transition (COT) is located at $y_{COT} = 334$ km.
%}{
%\begin{center}
%	\begin{tabular}{lcc}
%		\hline
%		\textbf{Geological meaning} & \textbf{Density} $\rho$ (kg/m$^{3}$) & \textbf{Horizontal extension}\\
%		\hline
%		water & 1030 & the whole model \\
%		\hline
%		sediments & 2350 & the whole model \\
%		SDR & 2750 & the whole model \\
%		\hline 
%		continental crust & 2770 & from $y = 0$ km until $y_{COT}$ \\
%		oceanic crust & 2865 & from $y_{COT}$ until $y = 383$ km \\
%		\hline
%		mantle & 3300 & the whole model \\
%		\hline
%	\end{tabular}
%\end{center}
%}
%
%\tabl{pelotas-model}{Properties of the interpretation model used to
%	invert the gravity data over the Pelotas basin.
%	The density contrasts are defined with respect to the
%	reference value $\rho^{(r)} = XXXX$ kg/m$^{3}$. The model extends from $y = 0$ km
%	to $y = XXX$ km. The Crust-Ocean Transition (COT) is located at $y_{COT} = XXX$ km.
%}{
%\begin{center}
%	\begin{tabular}{lcc}
%		\hline
%		\textbf{Geological meaning} & \textbf{Density} $\rho$ (kg/m$^{3}$) & \textbf{Horizontal extension}\\
%		\hline
%		water & 1030 & the whole model \\
%		\hline
%		sediments & XXXX & the whole model \\
%		SDR & XXXX & the whole model \\
%		\hline 
%		continental crust & XXXX & from $y = 0$ km until $y_{COT}$ \\
%		oceanic crust & XXXX & from $y_{COT}$ until $y = XXX$ km \\
%		\hline
%		mantle & XXXX & the whole model \\
%		\hline
%	\end{tabular}
%\end{center}
%}

%%%%%%%%%%%%%%%%%% Tables %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%% Figures %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\plot{rifted-margin-model-color}{width=\columnwidth}{
	{Rifted margin model formed by four layers. The first one 
	represents a water layer with constant density $\rho^{(w)}$. The second layer
	is formed by $Q = 2$ vertically adjacent parts. They represent sediments, salt or
	volcanic rocks and have constant densities $\rho^{(q)}$, $q = 1, \dots, Q$. The
	third layer represents the crust, which is divided into the continental crust, with
	a constant density $\rho^{(cc)}$, and the oceanic crust, with a constant density
	$\rho^{(oc)}$. We presume an abrupt Crust-Ocean Transition (COT). Finally, the
	fourth layer of our model represents a homogeneous mantle with constant density
	$\rho^{(m)}$. Basement and Moho are represented by the dashed-white lines. 
	The continuous white lines represent the isostatic compensation depth
	at $S_{0}$ and the reference Moho at $S_{0} + \Delta S$.}
	\label{fig:rifted-margin-model}
}

\plot{interpretation-model-color}{width=\columnwidth}{
	{Interpretation model formed by $N$ columns of vertically stacked prisms. 
	Each column is formed by four layers of prisms and locally approximates the four
	layers of the rifted margin model (Figure~\ref{fig:rifted-margin-model-color}).
	Each prism has a constant density contrast defined as the difference between
	its corresponding density at the rifted margin model (Figure~\ref{fig:rifted-margin-model-color})
	and the constant density $\rho^{(r)}$ of the shallowest layer forming
	the reference density distribution (see text).
	Basement and Moho are represented by the dashed-white lines. 
	The continuous white line represents the isostatic compensation depth
	at $S_{0}$. The base of the interpretation model coincides with the
	reference Moho located at $S_{0} + \Delta S$.}
	\label{fig:interpretation-model}
}


\plot{model-simple-I-no-vinc-isostatic-no-stripes}{width=0.6\textwidth}{
	{Application to synthetic data produced by the simple model I.
	 The numbers in the legend represent the density values in kg/m$^{3}$.
	 The bottom panel shows the estimated and true surfaces,
	 the initial basement and Moho used in the inversion (initial guess surfaces), 
	 as well as the known depths at basement (blue triangles) and Moho (green diamonds).
	 The middle panel shows the true and estimated lithostatic stress curves computed
	 by using equation~\ref{eq:lithostatic-stress-densities}. The values are multiplied 
	 by a constant gravity value equal to $9.81$ m/s$^{2}$.
	 The upper panel shows the true gravity disturbance data produced by the simple model 
	 I (simulated data), 
	 as well as the data produced by the estimated model (predicted data) and that produced
	 by the model used as initial guess in the inversion (initial guess data).
	 The estimated model was obtained by using all but the isostatic
	 constraint. For simplicity, the contour of the prisms forming the interpretation model 
	 were omitted.}
	\label{fig:simple-model-I-without-isostatic-constraint}
}


\plot{model-simple-I-no-stripes}{width=0.6\textwidth}{
	{Application to synthetic data produced by the simple model I.
	 The difference with respect to 
	 Figure~\ref{fig:simple-model-I-without-isostatic-constraint}
	 is that the estimated model was obtained by using all constraints.}
	\label{fig:simple-model-I-all-constraints}
}


\plot{model-simple-II-no-vinc-isostatic-no-stripes}{width=0.6\textwidth}{
	{Application to synthetic data produced by the simple model II.
		The numbers in the legend represent the density values in kg/m$^{3}$.
		The bottom panel shows the estimated and true surfaces,
		the initial basement and Moho used in the inversion (initial guess surfaces), 
		as well as the known depths at basement (blue triangles) and Moho (green diamonds).
		The middle panel shows the true and estimated lithostatic stress curves computed
		by using equation~\ref{eq:lithostatic-stress-densities}. The values are multiplied 
		by a constant gravity value equal to $9.81$ m/s$^{2}$.
		The upper panel shows the true gravity disturbance data produced by the simple model 
		II (simulated data), 
		as well as the data produced by the estimated model (predicted data) and that produced
		by the model used as initial guess in the inversion (initial guess data).
		The estimated model was obtained by using all but the isostatic
		constraint. For simplicity, the contour of the prisms forming the interpretation model 
		were omitted.}
	\label{fig:simple-model-II-without-isostatic-constraint}
}


\plot{model-simple-II-no-stripes}{width=0.6\textwidth}{
	{Application to synthetic data produced by the simple model II.
	 The difference with respect to
	 Figure~\ref{fig:simple-model-II-without-isostatic-constraint}
	 is that the estimated model was obtained by using all constraints.}
	\label{fig:simple-model-II-all-constraints}
}


\plot{pelotas-synthetic-data-no-vinc-isostatic-no-stripes}{width=0.6\textwidth}{
	{Application to synthetic data produced by the volcanic margin model.
		The numbers in the legend represent the density values in kg/m$^{3}$.
		The bottom panel shows the estimated and true surfaces,
		the initial basement and Moho used in the inversion (initial guess surfaces), 
		as well as the known depths at basement (blue triangles) and Moho (green diamonds).
		The middle panel shows the true and estimated lithostatic stress curves computed
		by using equation~\ref{eq:lithostatic-stress-densities}. The values are multiplied 
		by a constant gravity value equal to $9.81$ m/s$^{2}$.
		The upper panel shows the true gravity disturbance data produced by the volcanic 
		margin model (simulated data), 
		as well as the data produced by the estimated model (predicted data) and that produced
		by the model used as initial guess in the inversion (initial guess data).
		The estimated model was obtained by using all but the isostatic
		constraint. For simplicity, the contour of the prisms forming the interpretation model 
		were omitted.}
	\label{fig:volcanin-margin-without-isostatic-constraint}
}


\plot{pelotas-synthetic-data-no-stripes}{width=0.6\textwidth}{
	{Application to synthetic data produced by the volcanic margin model.
	 The difference with respect to
	 Figure~\ref{fig:volcanin-margin-without-isostatic-constraint}
	 is that the estimated model was obtained by using all constraints.}
	\label{fig:volcanin-margin-all-constraints}
}

%%%%%%%%%%%%%%%%%% Figures %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{ACKNOWLEDGMENTS}

\lipsum[0-1]


\newpage

\bibliographystyle{seg.bst}  % style file is seg.bst
\bibliography{bib-file.bib}


\end{document}

